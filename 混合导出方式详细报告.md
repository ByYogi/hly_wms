# æ··åˆå¯¼å‡ºæ–¹å¼è¯¦ç»†æŠ¥å‘Š (APIé¢„å¤„ç† + ASP.NET Buttonä¸‹è½½)

> ç”Ÿæˆæ—¶é—´: 2026-01-05
> æŸ¥æ‰¾æ–¹å¼: è‡ªåŠ¨åŒ–è„šæœ¬æ‰«æ

## ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ

- **ä½¿ç”¨æ··åˆæ–¹å¼çš„æ–‡ä»¶æ€»æ•°**: **57ä¸ª**
- **å æ‰€æœ‰å¯¼å‡ºæ–‡ä»¶æ¯”ä¾‹**: 57/71 = **80.3%**
- **å®ç°ç‰¹ç‚¹**: å…ˆè°ƒç”¨APIé¢„å¤„ç†æ•°æ®ï¼ŒæˆåŠŸåè§¦å‘ASP.NET Buttonä¸‹è½½

---

## ğŸ” å®ç°åŸç†

è¿™æ˜¯ä¸€ç§**æ··åˆæ–¹å¼**ï¼Œç»“åˆäº†APIè°ƒç”¨å’ŒASP.NETæœåŠ¡å™¨æ§ä»¶çš„ä¼˜ç‚¹ï¼š

### å·¥ä½œæµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»å‰ç«¯"å¯¼å‡º"æŒ‰é’®
   â†“
2. JavaScriptå‡½æ•°è°ƒç”¨ $.ajax å‘é€è¯·æ±‚åˆ° API
   â†“
3. æœåŠ¡å™¨ç«¯APIè¿›è¡Œæ•°æ®é¢„å¤„ç†:
   - æŸ¥è¯¢æ•°æ®
   - ç”ŸæˆExcelæ–‡ä»¶
   - ä¿å­˜åˆ°Sessionæˆ–ä¸´æ—¶æ–‡ä»¶
   - è¿”å› "OK" æˆ–æˆåŠŸæ ‡è¯†
   â†“
4. AJAX success å›è°ƒå‡½æ•°è§¦å‘éšè—çš„ <asp:Button>
   â†“
5. ASP.NET Buttonçš„OnClickäº‹ä»¶ä»Session/æ–‡ä»¶è¯»å–å¹¶ä¸‹è½½
```

### å…¸å‹ä»£ç æ¨¡å¼

```javascript
// å‰ç«¯å¯¼å‡ºå‡½æ•°
function BillExport() {
    var key = {
        AccountNO: $('#AAccountNO').val(),
        HouseID: $("#AHouseID").combobox('getValue'),
        ClientID: $("#APurchaserName").combobox('getValue'),
        StartDate: $('#StartDate').datebox('getValue'),
        EndDate: $('#EndDate').datebox('getValue')
    };

    $.ajax({
        url: "clientApi.aspx?method=QueryAccountSplittingForExport",
        type: 'post',
        data: key,
        success: function (text) {
            if (text == "OK") {
                // è§¦å‘éšè—çš„ASP.NET Button
                var obj = document.getElementById("<%=btnDerived.ClientID %>");
                obj.click();
            } else {
                $.messager.alert('ç³»ç»Ÿæç¤º', text, 'warning');
            }
        }
    });
}
```

```html
<!-- éšè—çš„ASP.NETæœåŠ¡å™¨æ§ä»¶ -->
<form runat="server" id="fm1">
    <asp:Button ID="btnDerived" runat="server" Style="display: none;"
                Text="å¯¼å‡º" OnClick="btnDerived_Click" />
</form>
```

```csharp
// åç«¯C#ä¸‹è½½ä»£ç 
protected void btnDerived_Click(object sender, EventArgs e)
{
    // ä»Sessionæˆ–ä¸´æ—¶æ–‡ä»¶è¯»å–é¢„å¤„ç†å¥½çš„æ•°æ®
    DataTable dt = Session["ExportData"] as DataTable;

    // ä¸‹è½½æ–‡ä»¶
    ExcelHelper.ExportToExcel(dt, "å¯¼å‡ºæ–‡ä»¶.xlsx", Response);

    // æ¸…ç†Session
    Session.Remove("ExportData");
}
```

---

## ğŸ“ ä½¿ç”¨æ··åˆæ–¹å¼çš„æ–‡ä»¶æ¸…å• (57ä¸ª)

### Arriveæ¨¡å— (6ä¸ª)
1. [AwbManager.aspx](House/Cargo/Cargo/Arrive/AwbManager.aspx) - è¿å•ç®¡ç†
2. [AwbStatusTrack.aspx](House/Cargo/Cargo/Arrive/AwbStatusTrack.aspx) - è¿å•çŠ¶æ€è·Ÿè¸ª
3. [CarStatusTrack.aspx](House/Cargo/Cargo/Arrive/CarStatusTrack.aspx) - è½¦è¾†çŠ¶æ€è·Ÿè¸ª
4. [DeliveryAwbManager.aspx](House/Cargo/Cargo/Arrive/DeliveryAwbManager.aspx) - é…é€è¿å•ç®¡ç†
5. [TransitAwbManager.aspx](House/Cargo/Cargo/Arrive/TransitAwbManager.aspx) - ä¸­è½¬è¿å•ç®¡ç†
6. [TruckContractManager.aspx](House/Cargo/Cargo/Arrive/TruckContractManager.aspx) - è´§è½¦åˆåŒç®¡ç†

### Clientæ¨¡å— (6ä¸ª)
1. [clientBillManager.aspx](House/Cargo/Cargo/Client/clientBillManager.aspx) - å®¢æˆ·è´¦å•ç®¡ç†
2. [clientManager.aspx](House/Cargo/Cargo/Client/clientManager.aspx) - å®¢æˆ·ç®¡ç†
3. [PurchaserManager.aspx](House/Cargo/Cargo/Client/PurchaserManager.aspx) - é‡‡è´­å‘˜ç®¡ç†
4. [SaleClientManager.aspx](House/Cargo/Cargo/Client/SaleClientManager.aspx) - é”€å”®å®¢æˆ·ç®¡ç†
5. [suppClientBillManager.aspx](House/Cargo/Cargo/Client/suppClientBillManager.aspx) - ä¾›åº”å•†è´¦å•ç®¡ç†
6. [wxClientCheck.aspx](House/Cargo/Cargo/Client/wxClientCheck.aspx) - å¾®ä¿¡å®¢æˆ·å®¡æ ¸

### Financeæ¨¡å— (10ä¸ª)
1. [financeCashierMoneyManager.aspx](House/Cargo/Cargo/Finance/financeCashierMoneyManager.aspx) - æ”¶é“¶ç®¡ç†
2. [financeExpenseCheck.aspx](House/Cargo/Cargo/Finance/financeExpenseCheck.aspx) - è´¹ç”¨å®¡æ ¸
3. [financeExpenseManager.aspx](House/Cargo/Cargo/Finance/financeExpenseManager.aspx) - è´¹ç”¨ç®¡ç†
4. [financeExpensePayMonitor.aspx](House/Cargo/Cargo/Finance/financeExpensePayMonitor.aspx) - è´¹ç”¨ä»˜æ¬¾ç›‘æ§
5. [financeExpenseReceiveMonitor.aspx](House/Cargo/Cargo/Finance/financeExpenseReceiveMonitor.aspx) - è´¹ç”¨æ”¶æ¬¾ç›‘æ§
6. [financeOrderReceiveMonitor.aspx](House/Cargo/Cargo/Finance/financeOrderReceiveMonitor.aspx) - è®¢å•æ”¶æ¬¾ç›‘æ§
7. [financeReceiveMoneyManager.aspx](House/Cargo/Cargo/Finance/financeReceiveMoneyManager.aspx) - æ”¶æ¬¾ç®¡ç†
8. [myExpense.aspx](House/Cargo/Cargo/Finance/myExpense.aspx) - æˆ‘çš„è´¹ç”¨

### Houseæ¨¡å— (5ä¸ª)
1. [InhouseManager.aspx](House/Cargo/Cargo/House/InhouseManager.aspx) - å…¥åº“ç®¡ç†
2. [OuthouseManager.aspx](House/Cargo/Cargo/House/OuthouseManager.aspx) - å‡ºåº“ç®¡ç†
3. [SafeStock.aspx](House/Cargo/Cargo/House/SafeStock.aspx) - å®‰å…¨åº“å­˜
4. [StockSnap.aspx](House/Cargo/Cargo/House/StockSnap.aspx) - åº“å­˜å¿«ç…§
5. [StockTakeManager.aspx](House/Cargo/Cargo/House/StockTakeManager.aspx) - ç›˜ç‚¹ç®¡ç†

### Orderæ¨¡å— (15ä¸ª)
1. [ArrivalOrderManager.aspx](House/Cargo/Cargo/Order/ArrivalOrderManager.aspx) - åˆ°è´§è®¢å•ç®¡ç†
2. [BatchImportOrder.aspx](House/Cargo/Cargo/Order/BatchImportOrder.aspx) - æ‰¹é‡å¯¼å…¥è®¢å•
3. [CreateTMallOrder.aspx](House/Cargo/Cargo/Order/CreateTMallOrder.aspx) - åˆ›å»ºå¤©çŒ«è®¢å•
4. [dealerOrderManger.aspx](House/Cargo/Cargo/Order/dealerOrderManger.aspx) - ç»é”€å•†è®¢å•ç®¡ç†
5. [FactoryOrderBarcode.aspx](House/Cargo/Cargo/Order/FactoryOrderBarcode.aspx) - å·¥å‚è®¢å•æ¡ç 
6. [FactoryPurchaseOrderManager.aspx](House/Cargo/Cargo/Order/FactoryPurchaseOrderManager.aspx) - å·¥å‚é‡‡è´­è®¢å•ç®¡ç†
7. [MoveOrderManager.aspx](House/Cargo/Cargo/Order/MoveOrderManager.aspx) - ç§»åº“è®¢å•ç®¡ç†
8. [orderCreatePicekPlan.aspx](House/Cargo/Cargo/Order/orderCreatePicekPlan.aspx) - åˆ›å»ºæ‹£è´§è®¡åˆ’
9. [OrderManager.aspx](House/Cargo/Cargo/Order/OrderManager.aspx) - è®¢å•ç®¡ç†
10. [orderPicekPlan.aspx](House/Cargo/Cargo/Order/orderPicekPlan.aspx) - æ‹£è´§è®¡åˆ’
11. [orderReturnManager.aspx](House/Cargo/Cargo/Order/orderReturnManager.aspx) - é€€è´§è®¢å•ç®¡ç†
12. [ReserveOrderManager.aspx](House/Cargo/Cargo/Order/ReserveOrderManager.aspx) - é¢„ç•™è®¢å•ç®¡ç†
13. [shopOrderImport.aspx](House/Cargo/Cargo/Order/shopOrderImport.aspx) - åº—é“ºè®¢å•å¯¼å…¥
14. [ShortageList.aspx](House/Cargo/Cargo/Order/ShortageList.aspx) - ç¼ºè´§åˆ—è¡¨
15. [TempOrderManager.aspx](House/Cargo/Cargo/Order/TempOrderManager.aspx) - ä¸´æ—¶è®¢å•ç®¡ç†

### Priceæ¨¡å— (2ä¸ª)
1. [priceCostManager.aspx](House/Cargo/Cargo/Price/priceCostManager.aspx) - æˆæœ¬ä»·ç®¡ç†
2. [priceModifyStatis.aspx](House/Cargo/Cargo/Price/priceModifyStatis.aspx) - ä»·æ ¼ä¿®æ”¹ç»Ÿè®¡

### Productæ¨¡å— (3ä¸ª)
1. [BasicSpecManager.aspx](House/Cargo/Cargo/Product/BasicSpecManager.aspx) - åŸºç¡€è§„æ ¼ç®¡ç†
2. [productReserveShelves.aspx](House/Cargo/Cargo/Product/productReserveShelves.aspx) - äº§å“é¢„ç•™è´§æ¶
3. [productShelves.aspx](House/Cargo/Cargo/Product/productShelves.aspx) - äº§å“è´§æ¶

### Purchaseæ¨¡å— (2ä¸ª)
1. **[RealFactoryPurchaseOrderManager.aspx](House/Cargo/Cargo/Purchase/RealFactoryPurchaseOrderManager.aspx)** - å®é™…å·¥å‚é‡‡è´­è®¢å•ç®¡ç†
2. **[RealPurchaseBillManager.aspx](House/Cargo/Cargo/Purchase/RealPurchaseBillManager.aspx)** - å®é™…é‡‡è´­å•ç®¡ç† â­(ç”¨æˆ·æä¾›çš„ç¤ºä¾‹)

### HuiCaiæ¨¡å— (1ä¸ª)
1. [huiCaiWarehouseStatistics.aspx](House/Cargo/Cargo/HuiCai/huiCaiWarehouseStatistics.aspx) - æ±‡é‡‡ä»“åº“ç»Ÿè®¡

### Reportæ¨¡å— (5ä¸ª)
1. [reportGross.aspx](House/Cargo/Cargo/Report/reportGross.aspx) - æ¯›åˆ©æŠ¥è¡¨
2. [reportHCYCStatis.aspx](House/Cargo/Cargo/Report/reportHCYCStatis.aspx) - æ±‡é‡‡äº‘ä»“ç»Ÿè®¡æŠ¥è¡¨
3. [reportOutTime.aspx](House/Cargo/Cargo/Report/reportOutTime.aspx) - æ—¶æ•ˆæŠ¥è¡¨
4. [reportSaleStock.aspx](House/Cargo/Cargo/Report/reportSaleStock.aspx) - é”€å”®åº“å­˜æŠ¥è¡¨
5. [reportWeixinMall.aspx](House/Cargo/Cargo/Report/reportWeixinMall.aspx) - å¾®ä¿¡å•†åŸæŠ¥è¡¨
6. [saleManReport.aspx](House/Cargo/Cargo/Report/saleManReport.aspx) - ä¸šåŠ¡å‘˜æŠ¥è¡¨

### QYæ¨¡å— (1ä¸ª)
1. [qyCheckin.aspx](House/Cargo/Cargo/QY/qyCheckin.aspx) - ä¼ä¸šç­¾åˆ°

### Systemæ¨¡å— (1ä¸ª)
1. [FeedBack.aspx](House/Cargo/Cargo/systempage/FeedBack.aspx) - åé¦ˆ

### Other (1ä¸ª)
1. [main.aspx](House/Cargo/Cargo/main.aspx) - ä¸»é¡µé¢

---

## ğŸ’¡ æ··åˆæ–¹å¼çš„ä¼˜åŠ¿

### âœ… ä¼˜ç‚¹
1. **æ•°æ®é¢„å¤„ç†**: APIå¯ä»¥æå‰å¤„ç†å¤æ‚çš„æ•°æ®é€»è¾‘,ç”ŸæˆExcelæ–‡ä»¶
2. **ç”¨æˆ·ä½“éªŒå¥½**: æ˜¾ç¤ºè¿›åº¦æç¤º `$.messager.progress()`
3. **é”™è¯¯å¤„ç†**: APIå¯ä»¥å…ˆéªŒè¯æ•°æ®,è¿”å›é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯
4. **çµæ´»æ€§é«˜**: å¯ä»¥æ ¹æ®è¿”å›çŠ¶æ€æ‰§è¡Œä¸åŒçš„ä¸‹è½½æŒ‰é’®
5. **åˆ†å·¥æ˜ç¡®**: APIè´Ÿè´£ä¸šåŠ¡é€»è¾‘,Buttonè´Ÿè´£æ–‡ä»¶ä¼ è¾“

### âŒ ç¼ºç‚¹
1. **ä»£ç è¾ƒå¤æ‚**: éœ€è¦å‰ç«¯AJAX + åç«¯API + åç«¯Buttonä¸‰å±‚
2. **Sessionä¾èµ–**: é€šå¸¸éœ€è¦Sessionå­˜å‚¨ä¸­é—´æ•°æ®
3. **å¹¶å‘é—®é¢˜**: å¤šç”¨æˆ·åŒæ—¶å¯¼å‡ºå¯èƒ½éœ€è¦å¤„ç†Sessionå†²çª

---

## ğŸ†š ä¸‰ç§å¯¼å‡ºæ–¹å¼å¯¹æ¯”

| å¯¹æ¯”é¡¹ | çº¯ASP.NET Button | çº¯APIæ–‡ä»¶æµ | **æ··åˆæ–¹å¼** |
|--------|-----------------|-----------|------------|
| **ä½¿ç”¨é¢‘ç‡** | 13ä¸ª (18.3%) | 1ä¸ª (1.4%) | **57ä¸ª (80.3%)** â­ |
| **ä»£ç å¤æ‚åº¦** | ä¸­ | ä½ | é«˜ |
| **ç”¨æˆ·ä½“éªŒ** | ä¸­ | é«˜ | **æœ€ä½³** âœ¨ |
| **é”™è¯¯å¤„ç†** | ä¸­ | ä½ | **æœ€ä½³** âœ¨ |
| **è¿›åº¦æç¤º** | âŒ | âŒ | **âœ…** |
| **æ•°æ®é¢„å¤„ç†** | âŒ | âœ… | **âœ…** |
| **é€‚ç”¨åœºæ™¯** | ç®€å•å¯¼å‡º | ç®€å•APIå¯¼å‡º | **å¤æ‚å¯¼å‡ºã€å¤§æ•°æ®é‡** |

---

## ğŸ“ ä»£ç è¯†åˆ«ç‰¹å¾

è¯†åˆ«ä½¿ç”¨æ··åˆæ–¹å¼çš„æ–‡ä»¶çš„å…³é”®ç‰¹å¾ï¼š

```javascript
// ç‰¹å¾1: $.ajax è°ƒç”¨
$.ajax({
    url: "xxxApi.aspx?method=xxxForExport",
    type: 'post',
    data: key,
    success: function (text) {
        // ç‰¹å¾2: åœ¨successå›è°ƒä¸­æ£€æŸ¥è¿”å›å€¼
        if (text == "OK") {
            // ç‰¹å¾3: é€šè¿‡ClientIDè·å–ASP.NET Buttonå¹¶è§¦å‘click
            var obj = document.getElementById("<%=btnDerived.ClientID %>");
            obj.click();
        }
    }
});
```

---

## ğŸ¯ æ€»ç»“

**æ··åˆæ–¹å¼å·²æˆä¸ºWMSç³»ç»Ÿçš„ä¸»æµå¯¼å‡ºå®ç°æ–¹å¼** (80.3%ä½¿ç”¨ç‡)ï¼Œå®ƒç»“åˆäº†ï¼š
- âœ… APIçš„çµæ´»æ€§å’Œæ•°æ®é¢„å¤„ç†èƒ½åŠ›
- âœ… ASP.NET Buttonçš„æ–‡ä»¶ä¸‹è½½èƒ½åŠ›
- âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ(è¿›åº¦æç¤ºã€é”™è¯¯å¤„ç†)

è¿™ç§æ–¹å¼ç‰¹åˆ«é€‚åˆï¼š
- éœ€è¦å¤æ‚æ•°æ®å¤„ç†çš„å¯¼å‡º
- éœ€è¦æ˜¾ç¤ºè¿›åº¦æç¤ºçš„å¯¼å‡º
- éœ€è¦æ•°æ®éªŒè¯çš„å¯¼å‡º
- å¤§æ•°æ®é‡å¯¼å‡º

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-05
**æ‰«æå·¥å…·**: PowerShellè‡ªåŠ¨åŒ–è„šæœ¬
**æŠ¥å‘Šä½œè€…**: Claude AI
