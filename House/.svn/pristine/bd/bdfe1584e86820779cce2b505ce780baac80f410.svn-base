<%@ Page Title="作废订单" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="TempOrderManager.aspx.cs" Inherits="Cargo.Order.TempOrderManager" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <script src="../JS/Rotate/jQueryRotate.2.2.js" type="text/javascript"></script>
    <style type="text/css">
        .commTblStyle_8 th {
            border: 1px solid rgb(205, 205, 205);
            text-align: center;
            color: rgb(255, 255, 255);
            line-height: 28px;
            background-color: rgb(15, 114, 171);
        }

        .commTblStyle_8 tr.BlankRow td {
            line-height: 10px;
        }

        .commTblStyle_8 tr td {
            border: 1px solid rgb(205, 205, 205);
            text-align: center;
            line-height: 20px;
        }

            .commTblStyle_8 tr td.left {
                text-align: right;
                padding-right: 10px;
                font-weight: bold;
                white-space: nowrap;
                background-color: rgb(239, 239, 239);
            }

            .commTblStyle_8 tr td.right {
                text-align: left;
                padding-left: 10px;
            }

        .commTblStyle_8 .whiteback {
            background-color: rgb(255, 255, 255);
        }
    </style>
    <script src="../JS/easy/js/datagrid-groupview.js" type="text/javascript"></script>
    <%--<script src="../JS/Date/CheckActivX.js" type="text/javascript"></script>--%>
    <script src="../JS/Lodop/LodopFuncs.js" type="text/javascript"></script>
    <script type="text/javascript">
        //页面加载显示遮罩层
        var pc;
        $.parser.onComplete = function () {
            if (pc) {
                clearTimeout(pc);
            }
            pc = setTimeout(closemask, 10);
        }
        //关闭加载中遮罩层
        function closemask() {
            $("#Loading").fadeOut("normal", function () {
                $(this).remove();
            });
        }
        window.onload = function () {
            $.ajaxSetup({ async: true });
            $.getJSON("../Client/clientApi.aspx?method=QueryAllUpClientDep", function (data) {
                UpClientDep = data;
            });
            adjustment();
            $('#PeriodsNum').numberbox({
                onChange: function (newValue, oldValue) {
                    if (newValue != null && newValue != "") {
                        var PeriodsNum = $('#PeriodsNum').val();
                        if (oldValue != null && oldValue != "") {
                            PeriodsNum = oldValue;
                        }
                        var Remark = $('#ARemark').val();
                        if (Remark != null && Remark != undefined) {
                            Remark = Remark.replace("周期" + PeriodsNum + "天，", "");
                            $('#ARemark').val('周期' + newValue + '天，' + Remark);
                        } else {
                            $('#ARemark').val('周期' + newValue + '天');
                        }
                    }
                }
            });
            $("#ARemark").focus(function () {
                $('#ARemark').val($('#HiddenRemark').val());
            });
            $("#ARemark").blur(function () {
                $('#HiddenRemark').val($('#ARemark').val());
                if ($("#CheckOutType").combobox('getValue') == "1" && $('#PeriodsNum').val() != null && $('#PeriodsNum').val() != "") {
                    $('#ARemark').val('周期' + $('#PeriodsNum').val() + '天，' + $('#HiddenRemark').val());
                }
            });
            var HID = "<%=UserInfor.HouseID%>";
            //如果是广州仓库显示公司类型选项
            if (HID == "9") {
                $("[name='BelongHouse']").show();
                $('#BelongHouse').combobox('setValue', 0);
            } else {
                $('#BelongHouse').combobox('setValue', -1);
                $("[name='BelongHouse']").hide();
            }
        }
        $(window).resize(function () {
            adjustment();
        });
        function adjustment() {
            var height = Number($(window).height()) - $("div[name='SelectDiv1']").outerHeight(true);
            $('#dg').datagrid({ height: height });
        }
        $(document).ready(function () {
            $('#dg').datagrid({
                width: '100%',
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: true, //是否可折叠
                pagination: true, //分页是否显示
                pageSize: Math.floor((Number($(window).height()) - $("div[name='SelectDiv1']").outerHeight(true) - 58) / 28), //每页多少条
                pageList: [Math.floor((Number($(window).height()) - $("div[name='SelectDiv1']").outerHeight(true) - 58) / 28), Math.floor((Number($(window).height()) - $("div[name='SelectDiv1']").outerHeight(true) - 58) / 28) * 2],
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'OrderID',
                url: null,
                toolbar: '#dgtoolbar',
                columns: [[
                    { title: '', field: 'OrderID', checkbox: true, width: '30px' },
                    {
                        title: '出库仓库', field: 'OutHouseName', width: '80px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '订单号', field: 'OrderNo', width: '90px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '出发站', field: 'Dep', width: '50px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '到达站', field: 'Dest', width: '50px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '件数', field: 'Piece', width: '35px', align: 'right', styler: function (val, row, index) { return "color:#12bb1f;font-weight:bold;" }, formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '收入', field: 'TransportFee', width: '50px', align: 'right', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '优惠券', field: 'InsuranceFee', width: '50px', align: 'right', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '合计', field: 'TotalCharge', width: '60px', align: 'right', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '付款人', field: 'PayClientName', width: '55px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '客户名称', field: 'AcceptUnit', width: '120px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '收货人', field: 'AcceptPeople', width: '55px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '联系手机', field: 'AcceptCellphone', width: '90px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '收货地址', field: 'AcceptAddress', width: '120px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '删除人', field: 'DeleteName', width: '55px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    { title: '删除时间', field: 'DeleteDate', width: '125px', formatter: DateTimeFormatter },
                    {
                        title: '业务员', field: 'SaleManName', width: '55px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '开单员ID', field: 'CreateAwbID', width: '60px', hidden: 'true', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '订单状态', field: 'AwbStatus', width: '60px',
                        formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='已下单'>已下单</span>"; }
                            else if (val == "1") { return "<span title='出库中'>出库中</span>"; }
                            else if (val == "2") { return "<span title='已出库'>已出库</span>"; }
                            else if (val == "3") { return "<span title='运输在途'>运输在途</span>"; }
                            else if (val == "4") { return "<span title='已到达'>已到达</span>"; }
                            else if (val == "5") { return "<span title='已签收'>已签收</span>"; }
                            else if (val == "6") { return "<span title='已拣货'>已拣货</span>"; }
                            else if (val == "7") { return "<span title='正在配送'>正在配送</span>"; }
                            else { return ""; }
                        }
                    },
                    { title: '开单时间', field: 'CreateDate', width: '125px', formatter: DateTimeFormatter },
                    {
                        title: '开单员', field: 'CreateAwb', width: '60px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '结算方式', field: 'CheckOutType', width: '60px',
                        formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='现付'>现付</span>"; }
                            else if (val == "1") { return "<span title='周期'>周期</span>"; }
                            else if (val == "2") { return "<span title='月结'>月结</span>"; }
                            else if (val == "3") { return "<span title='到付'>到付</span>"; }
                            else if (val == "4") { return "<span title='代收'>代收</span>"; }
                            else if (val == "5") { return "<span title='微信付款'>微信付款</span>"; }
                            else if (val == "6") { return "<span title='额度付款'>额度付款</span>"; }
                            else { return ""; }
                        }
                    },
                    {
                        title: '物流公司单号', field: 'LogisAwbNo', width: '90px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '下单方式', field: 'OrderType', width: '60px', formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='电脑下单'>电脑下单</span>"; }
                            else if (val == "1") { return "<span title='企业号下单'>企业号下单</span>"; }
                            else if (val == "2") { return "<span title='商城订单'>商城订单</span>"; }
                            else if (val == "3") { return "<span title='APP订单'>APP订单</span>"; }
                            else if (val == "4") { return "<span title='小程序下单'>小程序下单</span>"; }
                            else { return "<span title='电脑下单'>电脑下单</span>"; }
                        }
                    },
                    {
                        title: '商城订单号', field: 'WXOrderNo', width: '110px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '付款方式', field: 'PayWay', width: '60px', formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='微信付款'>微信付款</span>"; }
                            else if (val == "1") { return "<span title='额度付款'>额度付款</span>"; }
                            else if (val == "2") { return "<span title='积分兑换'>积分兑换</span>"; }
                            else { return ""; }
                        }
                    },
                    { title: '支付订单号', field: 'WXPayOrderNo', width: '190px' },
                    {
                        title: '审核状态', field: 'FinanceSecondCheck', width: '60px', formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='未审'>未审</span>"; }
                            else if (val == "1") { return "<span title='已审'>已审</span>"; }
                            else { return ""; }
                        }
                    },
                    {
                        title: '结算状态', field: 'CheckStatus', width: '60px', formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='未结算'>未结算</span>"; }
                            else if (val == "1") { return "<span title='已结算'>已结算</span>"; }
                            else if (val == "2") { return "<span title='未结清'>未结清</span>"; }
                            else { return ""; }
                        }
                    },
                    {
                        title: '物流配送费用', field: 'TransitFee', width: '80px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '物流公司名称', field: 'LogisticName', width: '90px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '订单类型', field: 'ThrowGood', width: '60px',
                        formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='客户单'>客户单</span>"; }
                            else if (val == "1") { return "<span title='抛货单'>抛货单</span>"; }
                            else if (val == "2") { return "<span title='内部单'>内部单</span>"; }
                            else if (val == "3") { return "<span title='代发单'>代发单</span>"; }
                            else if (val == "4") { return "<span title='周期胎'>周期胎</span>"; }
                            else if (val == "5") { return "<span title='长和订单'>长和订单</span>"; }
                            else if (val == "6") { return "<span title='商贸订单'>商贸订单</span>"; }
                            else if (val == "7") { return "<span title='其它订单'>其它订单</span>"; }
                            else if (val == "8") { return "<span title='理赔单'>理赔单</span>"; }
                            else if (val == "9") { return "<span title='移库单'>移库单</span>"; }
                            else if (val == "10") { return "<span title='祺航订单'>祺航订单</span>"; }
                            else if (val == "11") { return "<span title='展示单'>展示单</span>"; }
                            else if (val == "12") { return "<span title='OES客户单'>OES客户单</span>"; }
                            else if (val == "13") { return "<span title='自有零售店单'>自有零售店单</span>"; }
                            else if (val == "14") { return "<span title='报量单'>报量单</span>"; }
                            else if (val == "15") { return "<span title='速配单'>速配单</span>"; }
                            else if (val == "16") { return "<span title='促销单'>促销单</span>"; }
                            else if (val == "17") { return "<span title='急送单'>急送单</span>"; }
                            else if (val == "18") { return "<span title='异地单'>异地单</span>"; }
                            else if (val == "20") { return "<span title='电商单'>电商单</span>"; }
                            else if (val == "21") { return "<span title='订货单'>订货单</span>"; }
                            else { return ""; }
                        }
                    },
                    {
                        title: '仓库', field: 'TranHouse', width: '60px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '订单类型', field: 'TrafficType', width: '60px',
                        formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='内部订单'>内部订单</span>"; }
                            else if (val == "1") { return "<span title='外采订单'>外采订单</span>"; }
                            else { return ""; }
                        }
                    }
                ]],
                onClickRow: function (index, row) {
                    $('#dg').datagrid('clearSelections');
                    $('#dg').datagrid('selectRow', index);
                },
                rowStyler: function (index, row) {
                    if (row.ModifyPriceStatus == "1") { return "color:#a9a4a4"; };
                    if (row.AwbStatus == "5") { return "color:#2a83de"; };
                    if (row.AwbStatus == "1") { return "background-color:#f8e8e7"; };
                },
                onDblClickRow: function (index, row) { editItemByID(index); }
            });
            var datenow = new Date();
            $('#StartDate').datebox('setValue', getLastDayFormatDate(datenow));
            $('#EndDate').datebox('setValue', getNowFormatDate(datenow));
            $('#Dep').combobox('textbox').bind('focus', function () { $('#Dep').combobox('showPanel'); });
            $('#Dest').combobox('textbox').bind('focus', function () { $('#Dest').combobox('showPanel'); });
            $('#AOrderType').combobox('textbox').bind('focus', function () { $('#AOrderType').combobox('showPanel'); });
            //$('#CheckOutType').combobox('textbox').bind('focus', function () { $('#CheckOutType').combobox('showPanel'); });
            //所在仓库
            $('#AHouseID').combobox({
                url: '../House/houseApi.aspx?method=CargoPermisionHouse',
                valueField: 'HouseID', textField: 'Name',
                onSelect: function (rec) {
                    var HID = rec.HouseID;
                    //如果是广州仓库显示公司类型选项
                    if (HID == 9) {
                        $("[name='BelongHouse']").show();
                        $('#BelongHouse').combobox('setValue', 0);
                    } else {
                        $('#BelongHouse').combobox('setValue', -1);
                        $("[name='BelongHouse']").hide();
                    }
                    $('#ASaleManID').combobox('clear');
                    var url = '../Order/orderApi.aspx?method=QueryUserByDepCode&houseID=' + rec.HouseID;
                    $('#ASaleManID').combobox('reload', url);
                    $('#PID').combobox('clear');
                    var url = '../House/houseApi.aspx?method=QueryALLArea&pid=0&hid=' + rec.HouseID;
                    $('#PID').combobox('reload', url);
                }
            });
            $('#AHouseID').combobox('setValue', '<%=UserInfor.HouseID%>');
            $('#ASaleManID').combobox('clear');
            var url = '../Order/orderApi.aspx?method=QueryUserByDepCode&houseID=<%=UserInfor.HouseID%>';
            $('#ASaleManID').combobox('reload', url);
            $('#PID').combobox('clear');
            var url = '../House/houseApi.aspx?method=QueryALLArea&pid=0&hid=<%=UserInfor.HouseID%>';
            $('#PID').combobox('reload', url);

            //一级产品
            $('#APID').combobox({
                url: '../Product/productApi.aspx?method=QueryALLOneProductType', valueField: 'TypeID', textField: 'TypeName',
                onSelect: function (rec) {
                    $('#ASID').combobox('clear');
                    $('#ASID').combobox({
                        url: '../Product/productApi.aspx?method=QueryALLOneProductType&PID=' + rec.TypeID, valueField: 'TypeID', textField: 'TypeName', AddField: 'PinyinName',
                        filter: function (q, row) {
                            var opts = $(this).combobox('options');
                            return row[opts.textField].indexOf(q) >= 0 || row[opts.AddField].indexOf(q) >= 0;
                        },
                    });
                }
            });
            $('#APID').combobox('textbox').bind('focus', function () { $('#APID').combobox('showPanel'); });
            $('#ASID').combobox('textbox').bind('focus', function () { $('#ASID').combobox('showPanel'); });
            $('#ThrowGood').combobox('textbox').bind('focus', function () { $('#ThrowGood').combobox('showPanel'); });
            $('#AHouseID').combobox('textbox').bind('focus', function () { $('#AHouseID').combobox('showPanel'); });
            $('#PID').combobox('textbox').bind('focus', function () { $('#PID').combobox('showPanel'); });
            $('#ASaleManID').combobox('textbox').bind('focus', function () { $('#ASaleManID').combobox('showPanel'); });
            var value2 = 0
            $("#simg").rotate({ bind: { click: function () { value2 += 90; $(this).rotate({ animateTo: value2 }) } } });
            //所在仓库
            $('#ThrowID').combobox({ url: '../House/houseApi.aspx?method=QueryDLTHouse', valueField: 'HouseID', textField: 'Name' });
            //付款人
            $('#APayClientNum').combobox({ valueField: 'ClientNum', textField: 'Boss', delay: '10', url: '../Client/clientApi.aspx?method=AutoCompleteClient' });

            //动态设置下拉框的属性
            var HID = "<%=UserInfor.HouseID%>";
            var data = [];
            if (HID == "47") {
                data.push({ "text": "全部", "id": -1 });
                data.push({ "text": "长和订单", "id": 5 });
                data.push({ "text": "商贸订单", "id": 6 });
                data.push({ "text": "祺航订单", "id": 10 });
                data.push({ "text": "其它订单", "id": 7 });
                $("#ThrowGood").combobox("loadData", data);
            } else {
                data.push({ "text": "全部", "id": -1 });
                data.push({ "text": "客户单", "id": 0 });
                data.push({ "text": "抛货单", "id": 1 });
                data.push({ "text": "内部单", "id": 2 });
                data.push({ "text": "代发单", "id": 3 });
                data.push({ "text": "周期胎", "id": 4 });
                data.push({ "text": "理赔单", "id": 8 });
                data.push({ "text": "移库单", "id": 9 });
                data.push({ "text": "展示单", "id": 11 });
                data.push({ "text": "报量单", "id": 14 });
                data.push({ "text": "OES客户单", "id": 12 });
                data.push({ "text": "自有零售店单", "id": 13 });
                data.push({ "text": "速配单", "id": 15 });
                data.push({ "text": "促销单", "id": 16 });
                data.push({ "text": "急送单", "id": 17 });
                data.push({ "text": "异地单", "id": 18 });
                data.push({ "text": "电商单", "id": 20 });
                data.push({ "text": "订货单", "id": 21 });
                $("#ThrowGood").combobox("loadData", data);
            }
            $("#ThrowGood").combobox("setValue", -1);

            RoleCName = "<%=UserInfor.RoleCName%>";
            if (RoleCName.indexOf("安泰路斯") >= 0) {
                $('#AHouseID').combobox('setValue', '<%=UserInfor.HouseID%>');
                $("#AHouseID").combobox("readonly", true);
                $('#AHouseID').combobox('textbox').unbind('focus');
                $('#AHouseID').combobox('textbox').css('background-color', '#e8e8e8');
                $('#ASaleManID').combobox('setValue', 2370);
                $('#ASaleManID').combobox('setText', '赵武凯');
                $("#ASaleManID").combobox("readonly", true);
                $('#ASaleManID').combobox('textbox').unbind('focus');
                $('#ASaleManID').combobox('textbox').css('background-color', '#e8e8e8');
                $("#ThrowGood").combobox("readonly", true);
                $('#ThrowGood').combobox('textbox').unbind('focus');
                $('#ThrowGood').combobox('textbox').css('background-color', '#e8e8e8');
                $("#AOrderType").combobox("readonly", true);
                $('#AOrderType').combobox('textbox').unbind('focus');
                $('#AOrderType').combobox('textbox').css('background-color', '#e8e8e8');
                $('#APID').combobox('setValue', '1');
                $("#APID").combobox("readonly", true);
                $('#APID').combobox('textbox').unbind('focus');
                $('#APID').combobox('textbox').css('background-color', '#e8e8e8');
                //一级产品
                $('#ASID').combobox('clear');
                $('#ASID').combobox({
                    url: '../Product/productApi.aspx?method=QueryALLOneProductType&PID=1', valueField: 'TypeID', textField: 'TypeName', AddField: 'PinyinName',
                    filter: function (q, row) {
                        var opts = $(this).combobox('options');
                        return row[opts.textField].indexOf(q) >= 0 || row[opts.AddField].indexOf(q) >= 0;
                    },
                });

                $('#ASID').combobox('setValue', '258');
                $("#ASID").combobox("readonly", true);
                $('#ASID').combobox('textbox').unbind('focus');
                $('#ASID').combobox('textbox').css('background-color', '#e8e8e8');
            }
        });

        //查询
        function dosearch() {
            $('#dg').datagrid('clearSelections');
            var gridOpts = $('#dg').datagrid('options');
            gridOpts.url = 'orderApi.aspx?method=QueryOrderTempInfo';
            $('#dg').datagrid('load', {
                OrderNo: $('#AOrderNo').val(),
                LogisAwbNo: $('#LogisAwbNo').val(),
                AcceptPeople: $("#AcceptPeople").val(),
                Piece: $("#Piece").val(),
                StartDate: $('#StartDate').datebox('getValue'),
                EndDate: $('#EndDate').datebox('getValue'),
                FinanceSecondCheck: '-1',
                CheckOutType: '',
                ThrowGood: $("#ThrowGood").combobox('getValue'),
                OrderType: $("#AOrderType").combobox('getValue'),
                AwbStatus: $("#AAwbStatus").combobox('getValue'),
                Dep: $("#Dep").combobox('getText'),
                Dest: $("#Dest").combobox('getText'),
                HouseID: $("#AHouseID").combobox('getValue'),//仓库ID
                SaleManID: $('#ASaleManID').combobox('getValue'),
                CreateAwb: $('#ACreateAwb').textbox('getValue'),
                //FirstID: $("#PID").combobox('getValue'),//父ID
                OutHouseName: $("#PID").combobox('getText'),
                AcceptUnit: $('#AcceptUnit').val(),
                OrderModel: "0",//订单类型
                BelongHouse: $('#BelongHouse').combobox('getValue')//公司类型
            });
        }
    </script>

</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div id='Loading' style="position: absolute; z-index: 1000; top: 0px; left: 0px; width: 98%; height: 100%; background: white; text-align: center; padding: 5px 10px; display: table;">
        <div style="display: table-cell; vertical-align: middle">
            <h1><font size="9">页面加载中……</font></h1>
        </div>
    </div>
    <div id="saPanel" name="SelectDiv1" class="easyui-panel" title="" data-options="iconCls:'icon-search'">
        <table>
            <tr>
                <td style="text-align: right;">订单号:
                </td>
                <td>
                    <input id="AOrderNo" class="easyui-textbox" data-options="prompt:'请输入订单号'" style="width: 100px">
                </td>
                <td style="text-align: right;">出发站:
                </td>
                <td>
                    <input id="Dep" class="easyui-combobox" style="width: 100px;" data-options="valueField:'CityName',textField:'CityName',url:'../systempage/sysService.aspx?method=QueryAllCity'" /><!-- panelheight="auto"-->
                </td>
                <td style="text-align: right;">区域大仓:
                </td>
                <td>
                    <input id="AHouseID" class="easyui-combobox" style="width: 100px;" />
                </td>
                <td style="text-align: right;">物流单号:
                </td>
                <td>
                    <input id="LogisAwbNo" class="easyui-textbox" data-options="prompt:'请输入物流单号'" style="width: 100px">
                </td>
                <td style="text-align: right;">订单类型:
                </td>
                <td>
                    <input class="easyui-combobox" id="ThrowGood" style="width: 80px;" panelheight="auto" data-options="valueField:'id',textField:'text'">
                </td>
                <td style="text-align: right;">开单时间:
                </td>
                <td>
                    <input id="StartDate" class="easyui-datebox" style="width: 100px">~
                    <input id="EndDate" class="easyui-datebox" style="width: 100px">
                </td>
                <%--                <td style="text-align: right;">付款方式:
                </td>
                <td>
                    <input class="easyui-combobox" id="CheckOutType" data-options="url:'../Data/check.json',method:'get',valueField:'id',textField:'text',panelHeight:'auto'"
                        style="width: 70px;">
                </td>--%>
            </tr>
            <tr>
                <td style="text-align: right;">收货人:
                </td>
                <td>
                    <input id="AcceptPeople" class="easyui-textbox" data-options="prompt:'收货单位/人'" style="width: 100px;" />
                </td>
                <td style="text-align: right;">到达站:
                </td>
                <td>
                    <input id="Dest" class="easyui-combobox" style="width: 100px;" data-options="valueField:'CityName',textField:'CityName',url:'../systempage/sysService.aspx?method=QueryAllCity',multiple:true" />
                </td>
                <td style="text-align: right;">所属仓库:
                </td>
                <td>
                    <input id="PID" class="easyui-combobox" style="width: 100px;" data-options="valueField:'AreaID',textField:'Name'"
                        panelheight="auto" />
                </td>
                <td style="text-align: right;">订单状态:
                </td>
                <td>
                    <select class="easyui-combobox" id="AAwbStatus" style="width: 100px;" panelheight="auto">
                        <option value="-1">全部</option>
                        <option value="0">已下单</option>
                        <option value="6">已拣货</option>
                        <option value="1">出库中</option>
                        <option value="2">已出库</option>
                        <option value="3">已装车</option>
                        <%-- <option value="4">已到达</option>--%>
                        <option value="5">已签收</option>
                    </select>
                </td>

                <td style="text-align: right;">下单方式:
                </td>
                <td>
                    <select class="easyui-combobox" id="AOrderType" style="width: 80px;" panelheight="auto">
                        <option value="-1">全部</option>
                        <option value="0">电脑下单</option>
                        <option value="1">企业号下单</option>
                        <option value="2">商城下单</option>
                        <option value="3">APP下单</option>
                        <option value="4">小程序下单</option>
                    </select>
                </td>

                <td style="text-align: right;">订单件数:
                </td>
                <td>
                    <input id="Piece" class="easyui-textbox" data-options="prompt:'请输入件数'" style="width: 80px">
                </td>
            </tr>
            <tr>
                <td style="text-align: right;">客户名称:
                </td>
                <td>
                    <input id="AcceptUnit" class="easyui-textbox" data-options="prompt:'请输入客户名称'" style="width: 100px">
                </td>
                <td style="text-align: right;">开单员:
                </td>
                <td>
                    <input id="ACreateAwb" class="easyui-textbox" data-options="prompt:'请输入开单员'" style="width: 100px">
                </td>
                <td style="text-align: right;">业务员:
                </td>
                <td>
                    <input id="ASaleManID" class="easyui-combobox" style="width: 100px;"
                        data-options="valueField: 'LoginName',textField: 'UserName'" />
                </td>
                <td style="text-align: right;">一级产品:
                </td>
                <td>
                    <input id="APID" class="easyui-combobox" style="width: 100px;"
                        panelheight="auto" />
                </td>
                <td style="text-align: right;">二级产品:
                </td>
                <td>
                    <input id="ASID" class="easyui-combobox" style="width: 80px;" data-options="valueField:'TypeID',textField:'TypeName'" />
                </td>
                <td name="BelongHouse" style="text-align: right;">公司类型:
                </td>
                <td name="BelongHouse">
                    <select class="easyui-combobox" id="BelongHouse" style="width: 80px;" panelheight="auto">
                        <option value="0">迪乐泰</option>
                        <option value="1">好来运</option>
                    </select>
                </td>
            </tr>
        </table>
    </div>
    <table id="dg" class="easyui-datagrid">
    </table>
    <div id="dgtoolbar">
        <a href="#" class="easyui-linkbutton" iconcls="icon-search" plain="false" onclick="dosearch()">&nbsp;查&nbsp;询&nbsp;</a>&nbsp;&nbsp;
    </div>
    <input type="hidden" id="DisplayNum" />
    <input type="hidden" id="DisplayPiece" />
    <div id="dlgOrder" class="easyui-dialog" style="width: 1100px; height: 555px;" closed="true"
        closable="false" buttons="#dlgOrder-buttons">
        <form id="fmDep" method="post">
            <input type="hidden" name="SaleManName" id="SaleManName" />
            <input type="hidden" name="SaleCellPhone" id="SaleCellPhone" />
            <input type="hidden" name="HouseCode" id="HouseCode" />
            <input type="hidden" name="HouseID" id="HouseID" />
            <input type="hidden" name="ONum" id="ONum" />
            <input type="hidden" name="OutNum" id="OutNum" />
            <input type="hidden" name="OrderID" id="OrderID" />
            <input type="hidden" name="OrderNo" id="OrderNo" />
            <input type="hidden" name="ClientNum" id="ClientNum" />
            <input type="hidden" name="TrafficType" />
            <input type="hidden" id="HiddenClientNum" />
            <input type="hidden" id="HiddenAcceptPeople" />
            <input type="hidden" id="HiddenLimitID" />
            <input type="hidden" id="HiddenLimitTitle" />
            <input type="hidden" id="HiddenRemark" />
            <div id="saPanel">
                <table style="width: 100%">
                    <tr>

                        <td style="color: Red; font-weight: bolder; text-align: right;">出发站:
                        </td>
                        <td>
                            <input name="Dep" id="ADep" class="easyui-textbox" readonly="readonly" style="width: 60px" data-options="disabled:true">
                        </td>
                        <td style="color: Red; font-weight: bolder; text-align: right;">到达站:
                        </td>
                        <td>
                            <input name="Dest" id="ADest" class="easyui-combobox" style="width: 60px;" data-options="valueField:'CityName',textField:'CityName',url:'../systempage/sysService.aspx?method=QueryAllCity',required:true ,disabled:true" />
                        </td>
                        <td style="text-align: right;">收货人:
                        </td>
                        <td>
                            <input name="AcceptPeople" id="AAcceptPeople" style="width: 80px;" class="easyui-combobox" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right;">公司名称:
                        </td>
                        <td>
                            <input name="AcceptUnit" id="AAcceptUnit" class="easyui-textbox" style="width: 80px;" data-options="disabled:true" />
                        </td>

                        <td style="text-align: right;">收货地址:
                        </td>
                        <td>
                            <input name="AcceptAddress" id="AAcceptAddress" style="width: 100px;" class="easyui-textbox" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right;">电话:
                        </td>
                        <td>
                            <input name="AcceptTelephone" id="AAcceptTelephone" class="easyui-textbox" style="width: 90px;" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right;">手机:
                        </td>
                        <td>
                            <input name="AcceptCellphone" id="AAcceptCellphone" class="easyui-textbox" data-options="disabled:true" style="width: 90px;" />
                        </td>

                    </tr>

                    <tr>
                        <td style="text-align: right;">销售费用:
                        </td>
                        <td>
                            <input name="TransportFee" id="TransportFee" data-options="min:0,precision:2,disabled:true" class="easyui-numberbox" style="width: 60px;" />
                        </td>
                        <td style="text-align: right;">送货费用:
                        </td>
                        <td>
                            <input name="TransitFee" id="TransitFee" data-options="min:0,precision:2,disabled:true" class="easyui-numberbox" style="width: 60px;" />
                        </td>
                        <td style="text-align: right; display: none">提货费用:
                        </td>
                        <td style="display: none">
                            <input name="DeliveryFee" id="DeliveryFee" data-options="min:0,precision:2" class="easyui-numberbox" style="width: 80px;" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right; display: none">其它费用:
                        </td>
                        <td style="display: none">
                            <input name="OtherFee" id="OtherFee" class="easyui-numberbox" data-options="min:0,precision:2" style="width: 80px;" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right; color: #f53333">优惠券:
                        </td>
                        <td>
                            <select name="InsuranceFee" id="InsuranceFee" class="easyui-combogrid" style="width: 80px" data-options="disabled:true">
                            </select>
                        </td>
                        <td style="text-align: right; display: none">回扣:
                        </td>
                        <td style="display: none">
                            <input name="Rebate" id="Rebate" data-options="min:0,precision:2,disabled:true" class="easyui-numberbox" style="width: 90px;" />
                        </td>
                        <td style="text-align: right;">费用合计:
                        </td>
                        <td>
                            <input name="TotalCharge" id="TotalCharge" class="easyui-numberbox" data-options="min:0,precision:2,disabled:true" style="width: 80px;" />
                        </td>
                        <td style="text-align: right;">付款方式:
                        </td>
                        <td>
                            <select class="easyui-combobox" id="CheckOutType" name="CheckOutType" style="width: 60px;" data-options="disabled:true" panelheight="auto" editable="false">
                                <option value="2">月结</option>
                                <option value="0">现付</option>
                                <option value="1">周期</option>
                                <option value="4">代收</option>
                            </select>
                            <input id="PeriodsNum" data-options="min:0,precision:0,disabled:true" class="easyui-numberbox"
                                style="width: 35px;" />
                            <label id="PeriodsNumLab" style="text-align: left;">天</label>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td style="text-align: right;">总件数:
                        </td>
                        <td>
                            <input name="Piece" id="APiece" class="easyui-numberbox" data-options="min:0,precision:0,disabled:true" style="width: 60px;" readonly="true" />
                        </td>
                        <td style="text-align: right;">开单员:
                        </td>
                        <td>
                            <input name="CreateAwb" id="CreateAwb" class="easyui-textbox" readonly="true" style="width: 60px;" data-options="disabled:true" />
                        </td>
                        <td style="text-align: right;">开单时间:
                        </td>
                        <td colspan="3">
                            <input name="CreateDate" id="CreateDate" class="easyui-datetimebox" data-options="formatter:AllDateTime,disabled:true" readonly="true" style="width: 150px;" />
                        </td>
                        <td style="text-align: right;">业务员:
                        </td>
                        <td>
                            <input name="SaleManID" id="SaleManID" class="easyui-combobox" style="width: 100px;"
                                data-options="url: 'orderApi.aspx?method=QueryUserByDepCode',valueField: 'LoginName',textField: 'UserName',disabled:true" />
                        </td>
                        <td style="text-align: right;">物流名称:
                        </td>
                        <td>
                            <input name="LogisID" id="ALogisID" class="easyui-combobox" style="width: 90px;" data-options="panelHeight:'200px',valueField:'ID',textField:'LogisticName',url:'../systempage/sysService.aspx?method=QueryAllLogistic',disabled:true"
                                panelheight="auto" />
                        </td>
                        <td style="text-align: right;">物流单号:
                        </td>
                        <td>
                            <input name="LogisAwbNo" id="ALogisAwbNo" class="easyui-textbox" style="width: 90px;" data-options="disabled:true" />
                        </td>
                    </tr>
                    <tr>
                    </tr>
                    <tr>
                        <td style="text-align: right;" rowspan="2">备注:
                        </td>
                        <td colspan="7" rowspan="2">
                            <textarea name="Remark" id="ARemark" rows="3" style="width: 450px; resize: none" data-options="disabled:true"></textarea>
                        </td>
                        <td style="text-align: right;">付款人:</td>
                        <td>
                            <input name="PayClientNum" id="APayClientNum" style="width: 100px;" class="easyui-combobox" data-options="disabled:true" /></td>

                        <td style="text-align: right;">调货仓库:</td>
                        <td>
                            <input id="ThrowID" class="easyui-combobox" style="width: 90px;" data-options="disabled:true" /></td>
                        <td style="text-align: right;">物流结算:
                        </td>
                        <td>
                            <select class="easyui-combobox" id="ADeliverySettlement" name="DeliverySettlement" data-options="disabled:true" style="width: 90px;" panelheight="auto" editable="false">
                                <option value="-1">&nbsp;</option>
                                <option value="0">现付</option>
                                <option value="1">到付</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6" style="text-align: left;" id="OrderModel">
                            <input class="DLT" type="checkbox" name="ThrowGood" id="ThrwG" value="1" />
                            <label class="DLT" for="ThrwG">抛货单</label>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="HuiYi" value="4" />
                            <label class="DLT" for="HuiYi">周期胎</label>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="LiPei" value="8" />
                            <label class="DLT" for="LiPei">理赔单</label>
                            <%--   <input class="DLT" type="checkbox" name="ThrowGood" id="Tran" value="2" />
                            <label class="DLT" for="Tran">内部调货单</label>--%>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="SuPei" value="15" />
                            <label class="DLT" for="SuPei">速配单</label>

                            <input class="DLT" type="checkbox" name="ThrowGood" id="DianShang" value="20" />
                            <label class="DLT" for="DianShang" id="DianShangLab">电商单</label>
                            <%--                            <input class="DLT" type="checkbox" name="ThrowGood" id="DaiFa" value="3" />
                            <label class="DLT" for="DaiFa">代发单</label>--%>
                            <br />
                            <input class="DLT" type="checkbox" name="ThrowGood" id="YiKu" value="9" />
                            <label class="DLT" for="YiKu">移库单</label>
                            <%--   <input class="DLT" type="checkbox" name="ThrowGood" id="ZhanShi" value="11" />
                            <label class="DLT" for="ZhanShi">展示单</label>--%>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="YiDi" value="18" />
                            <label class="DLT" for="YiDi">异地单</label>
                            <%--<input class="DLT" type="checkbox" name="ThrowGood" id="Baoliang" value="14" />
                            <label class="DLT" for="Baoliang">报量单</label>--%>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="CuXiao" value="16" />
                            <label class="DLT" for="CuXiao">促销单</label>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="OES" value="12" />
                            <label class="DLT" for="OES">OES客户单</label>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="ZiYou" value="13" />
                            <label class="DLT" for="ZiYou">二批单</label>
                            <input class="DLT" type="checkbox" name="ThrowGood" id="JiSong" value="17" />
                            <label class="DLT" for="JiSong">急送单</label>
                            <input class="FTS" type="checkbox" name="ThrowGood" id="ChangHe" value="5" />
                            <label class="FTS" for="ChangHe">长和订单</label>
                            <input class="FTS" type="checkbox" name="ThrowGood" id="ShangMao" value="6" />
                            <label class="FTS" for="ShangMao">商贸订单</label>
                            <input class="FTS" type="checkbox" name="ThrowGood" id="qihang" value="10" />
                            <label class="FTS" for="qihang">祺航订单</label>
                            <input class="FTS" type="checkbox" name="ThrowGood" id="QiTa" value="7" />
                            <label class="FTS" for="QiTa">其它订单</label>
                        </td>
                    </tr>
                </table>
            </div>
        </form>
        <table>
            <tr>
                <td>
                    <input type="hidden" id="dgSaveAwbStatus" />
                    <input type="hidden" id="dgSaveoldPiece" />
                    <table id="dgSave" class="easyui-datagrid">
                    </table>
                </td>
            </tr>
        </table>

    </div>
    <div id="dlgOrder-buttons">
        <table style="width: 100%">
            <tr>
                <td align="left">
                    <input type="checkbox" id="IsPrintPrice" value="1" />
                    <label for="IsPrintPrice">打印价格</label>
                </td>
                <td>
                    <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="closeDlg()">&nbsp;关&nbsp;闭&nbsp;</a>
                </td>
            </tr>
        </table>
    </div>


    <object id="LODOP_OB" title="dd" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA"
        width="0px" height="0px">
        <embed id="LODOP_EM" type="application/x-print-lodop" width="0px" height="0px"></embed>
    </object>
    <script type="text/javascript">
        //根据公司部门ID获取部门名称
        function GetUpClientDepName(value) {
            var name = '';
            if (value != "") {
                for (var i = 0; i < UpClientDep.length; i++) {
                    if (UpClientDep[i].ID == value) {
                        name = UpClientDep[i].DepName;
                        break;
                    }
                }
            }
            return name;
        };
        function CheckOutTypeChange(item) {
            if (item.value == 1) {
                $('#PeriodsNum').next(".numberbox").show();
                $("#PeriodsNumLab").css("visibility", "visible");
                $("#PeriodsNum").numberbox('options').required = true;
                $("#PeriodsNum").numberbox('textbox').validatebox('options').required = true;
                $("#PeriodsNum").numberbox('validate');
            } else {
                var Remark = $('#ARemark').val();
                Remark = Remark.replace("周期" + $('#PeriodsNum').val() + "天，", "");
                $('#ARemark').val(Remark);
                $('#PeriodsNum').numberbox('clear');
                $('#PeriodsNum').next(".numberbox").hide();
                $("#PeriodsNumLab").css("visibility", "hidden");
                $("#PeriodsNum").numberbox('options').required = false;
                $("#PeriodsNum").numberbox('textbox').validatebox('options').required = false;
                $("#PeriodsNum").numberbox('validate');
            }
        }
        //复选框只能选中一个
        $(function () {
            $('#OrderModel').find('input[type=checkbox]').bind('click', function () {
                var id = $(this).attr("id");
                if (this.checked) {
                    $("#OrderModel").find('input[type=checkbox]').not(this).attr("checked", false);
                }
            });
        })


        //双击显示订单详细界面 
        function editItemByID(Did) {
            IsModifyOrder = false;
            editIndex = undefined;
            var row = $("#dg").datagrid('getData').rows[Did];
            if (row) {
                if (row.HouseID == "47") {
                    $(".FTS").show();
                    $(".DLT").hide();
                } else {
                    $(".FTS").hide();
                    $(".DLT").show();
                }
                $('#dgSaveAwbStatus').val(row.AwbStatus);
                $('#dlgOrder').dialog('open').dialog('setTitle', '修改订单：' + row.OrderNo);
                $('#fmDep').form('clear');
                $('#PeriodsNum').next(".numberbox").hide();
                $("#PeriodsNumLab").css("visibility", "hidden");
                $("#PeriodsNum").numberbox('options').required = false;
                $("#PeriodsNum").numberbox('textbox').validatebox('options').required = false;
                $("#PeriodsNum").numberbox('validate');
                $('#HiddenAcceptPeople').val(row.AcceptPeople);
                $('#HiddenClientNum').val(row.ClientNum);
                if (RoleCName.indexOf("安泰路斯") >= 0) {
                    $(".DLT").hide();
                    $(".FTS").hide();
                }
                //客户姓名
                //$('#AAcceptPeople').combobox({
                //    valueField: 'Boss',
                //    textField: 'Boss',
                //    delay: '10',
                //    url: '../Client/clientApi.aspx?method=AutoCompleteClient',
                //    onSelect: onAcceptAddressChanged,
                //    required: true
                //});
                //客户姓名
                //$('#InsuranceFee').combogrid({
                //    method: 'get', panelWidth: '150', idField: 'ID', textField: 'Money',
                //    url: 'orderApi.aspx?method=QueryMyCoupon&ClientNum=' + row.ClientNum,
                //    columns: [[{ field: 'Money', title: '券金额', width: 50 }, { field: 'UseStatus', title: '使用状态', width: 50, formatter: function (val, row, index) { if (val == "0") { return "未使用"; } } }]],
                //    fitColumns: true, onSelect: function (rowIndex, rowData) {
                //        var t = Number($('#TransitFee').numberbox('getValue')) + Number($('#TransportFee').numberbox('getValue')) + Number($('#DeliveryFee').numberbox('getValue')) + Number($('#OtherFee').numberbox('getValue')) - Number(rowData.Money);
                //        $('#TotalCharge').numberbox('setValue', Number(t).toFixed(2));
                //    }
                //});
                row.CreateDate = AllDateTime(row.CreateDate);
                $('#fmDep').form('load', row);
                if (row.CheckOutType == 1) {
                    $('#PeriodsNum').next(".numberbox").show();
                    $("#PeriodsNumLab").css("visibility", "visible");
                    $("#PeriodsNum").numberbox('options').required = true;
                    $("#PeriodsNum").numberbox('textbox').validatebox('options').required = true;
                    $("#PeriodsNum").numberbox('validate');
                    if (row.Remark.indexOf("周期") == 0) {
                        $('#HiddenRemark').val(row.Remark.replace(row.Remark.split('，')[0] + "，", ""));
                        $('#PeriodsNum').numberbox('setValue', row.Remark.substring(row.Remark.indexOf("周期") + 2, row.Remark.indexOf("天")));
                    }
                } else {
                    $('#HiddenRemark').val(row.Remark);
                }
                $('#ThrowID').combobox('setText', row.TranHouse);
                $('#ThrwG').prop('checked', false);
                $('#Tran').prop('checked', false);
                $('#DaiFa').prop('checked', false);
                if (row.ThrowGood == "1") { $('#ThrwG').prop('checked', true); } else if (row.ThrowGood == "2") { $('#Tran').prop('checked', true); } else if (row.ThrowGood == "3") { $('#DaiFa').prop('checked', true); }
                if (row.IsPrintPrice == "1") { $('#IsPrintPrice').prop('checked', true); }
                $('#up').show();
                $('#save').show();
                $('#payprint').show();
                $('#pickprint').show();
                var columns = [];

                if (row.ModifyPriceStatus == "1") {
                    //灰掉按钮
                    $('#up').hide();
                    $('#save').hide();
                    $('#payprint').hide();
                    $('#pickprint').hide();
                    columns.push({ title: '出库件数', field: 'Piece', width: '60px' });
                    columns.push({ title: '业务员价', field: 'ActSalePrice', width: '60px' });
                } else {
                    columns.push({ title: '出库件数', field: 'Piece', width: '60px', editor: { type: 'numberbox' } });
                    columns.push({ title: '业务员价', field: 'ActSalePrice', width: '60px', editor: { type: 'numberbox', options: { precision: 2 } } });
                }

                if (row.HouseID == "47") {
                    columns.push({
                        title: '产品名称', field: 'ProductName', width: '110px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    });
                    columns.push({
                        title: '规格', field: 'Specs', width: '80px', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    });
                    columns.push({ title: '富添盛编码', field: 'GoodsCode', width: '70px' });
                    columns.push({ title: '统采编码', field: 'Model', width: '110px' });
                    columns.push({ title: '长和编码', field: 'Figure', width: '110px' });
                    columns.push({ title: '批次', field: 'Batch', width: '50px' });
                    columns.push({ title: '产品类型', field: 'TypeName', width: '60px' });
                    columns.push({ title: '单位', field: 'Package', width: '60px' });
                } else {
                    columns.push({ title: '型号', field: 'Model', width: '80px' });
                    columns.push({ title: '规格', field: 'Specs', width: '80px' });
                    columns.push({ title: '花纹', field: 'Figure', width: '90px' });
                    columns.push({ title: '批次', field: 'Batch', width: '50px' });
                    columns.push({ title: '速度级别', field: 'SpeedLevel', width: '60px' });
                    columns.push({ title: '载重指数', field: 'LoadIndex', width: '60px' });
                    columns.push({ title: '产品类型', field: 'TypeName', width: '70px' });
                    columns.push({
                        title: '归属部门', field: 'BelongDepart', width: '100px', formatter: function (value) {
                            return "<span title='" + GetUpClientDepName(value) + "'>" + GetUpClientDepName(value) + "</span>";
                        }
                    });
                }
                columns.push({ title: '货位代码', field: 'ContainerCode', width: '90px' });
                columns.push({ title: '所在区域', field: 'AreaName', width: '90px' });
                columns.push({ title: '所在仓库', field: 'FirstAreaName', width: '90px' });
                columns.push({ title: '产品ID', field: 'ProductID', width: '60px' });
                columns.push({ title: '优惠规则类型', field: 'RuleType', hidden: true });
                columns.push({ title: '优惠规则ID', field: 'RuleID', hidden: true });
                columns.push({ title: '优惠规则名称', field: 'RuleTitle', hidden: true });
                $("#APayClientNum").combobox("setValue", row.PayClientNum);
                showGrid(columns, row.HouseID);

                var gridOpts = $('#dgSave').datagrid('options');
                gridOpts.url = 'orderApi.aspx?method=QueryOrderTempByOrderNo&OrderNo=' + row.OrderNo;
                //所在仓库
                //$('#AHID').combobox({
                //    url: '../House/houseApi.aspx?method=CargoPermisionHouse',
                //    valueField: 'HouseID', textField: 'Name',
                //    onSelect: function (rec) {
                //        $('#HID').combobox('clear');
                //        var url = '../House/houseApi.aspx?method=QueryALLArea&pid=0&hid=' + rec.HouseID;
                //        $('#HID').combobox('reload', url);
                //    }
                //});
                $('#AHID').combobox('setValue', '<%=UserInfor.HouseID%>');
                $('#HID').combobox('clear');
                var url = '../House/houseApi.aspx?method=QueryALLArea&pid=0&hid=<%=UserInfor.HouseID%>';
                $('#HID').combobox('reload', url);
            }
        }
        //显示列表
        function showGrid(dgSaveCol, houseID) {
            var columns = [];
            if (houseID == "47") {
                columns.push({ title: '', field: 'ID', checkbox: true, width: '30px' });
                columns.push({ title: '在库件数', field: 'Piece', width: '60px' });
                columns.push({
                    title: '产品名称', field: 'ProductName', width: '80px', formatter: function (value) {
                        return "<span title='" + value + "'>" + value + "</span>";
                    }
                });
                columns.push({
                    title: '规格', field: 'Specs', width: '75px', formatter: function (value) {
                        return "<span title='" + value + "'>" + value + "</span>";
                    }
                });
                columns.push({ title: '富添盛编码', field: 'GoodsCode', width: '70px' });
                columns.push({ title: '统采编码', field: 'Model', width: '110px' });
                columns.push({ title: '长和编码', field: 'Figure', width: '110px' });
                columns.push({ title: '批次', field: 'Batch', width: '50px' });
                columns.push({ title: '销售价', field: 'SalePrice', width: '50px' });
                columns.push({ title: '产品类型', field: 'TypeName', width: '60px' });
                columns.push({ title: '货位代码', field: 'ContainerCode', width: '80px' });
                columns.push({ title: '所在区域', field: 'AreaName', width: '60px' });
                columns.push({ title: '所在仓库', field: 'FirstAreaName', width: '80px' });
                columns.push({ title: '产品ID', field: 'ProductID', width: '60px' });
            } else {
                columns.push({ title: '', field: 'ID', checkbox: true, width: '30px' });
                columns.push({ title: '在库件数', field: 'Piece', width: '60px' });
                columns.push({ title: '型号', field: 'Model', width: '55px' });
                columns.push({ title: '规格', field: 'Specs', width: '75px' });
                columns.push({ title: '花纹', field: 'Figure', width: '70px' });
                columns.push({ title: '批次', field: 'Batch', width: '50px' });
                columns.push({ title: '速度级别', field: 'SpeedLevel', width: '50px' });
                columns.push({ title: '载重指数', field: 'LoadIndex', width: '50px' });
                columns.push({ title: '销售价', field: 'SalePrice', width: '50px' });
                columns.push({ title: '产品类型', field: 'TypeName', width: '60px' });
                columns.push({ title: '货位代码', field: 'ContainerCode', width: '80px' });
                columns.push({ title: '所在区域', field: 'AreaName', width: '60px' });
                columns.push({ title: '所在仓库', field: 'FirstAreaName', width: '80px' });
                columns.push({ title: '产品ID', field: 'ProductID', width: '60px' });
            }
            $('#dgSave').datagrid({
                width: '1080px',
                height: '310px',
                title: '出库产品', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: true, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'ID',
                url: null,
                toolbar: '',
                columns: [dgSaveCol]
            });
        }

        //$.extend($.fn.datagrid.methods, {
        //    editCell: function (jq, param) {
        //        return jq.each(function () {
        //            var fields = $(this).datagrid('getColumnFields');
        //            for (var i = 0; i < fields.length; i++) {
        //                var col = $(this).datagrid('getColumnOption', fields[i]);
        //                col.editor1 = col.editor;
        //                if (fields[i] != param.field) {
        //                    col.editor = null;
        //                }
        //            }
        //            $(this).datagrid('beginEdit', param.index);
        //            for (var i = 0; i < fields.length; i++) {
        //                var col = $(this).datagrid('getColumnOption', fields[i]);
        //                col.editor = col.editor1;
        //            }
        //        });
        //    }
        //});
        //var IsModifyOrder = false;
        //var editIndex = undefined;

        //关闭弹出框
        function closeDlg() {
            if (IsModifyOrder) {
                $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '请先保存订单再关闭！', 'warning');
                return;
            }
            $('#dlgOrder').dialog('close');
            $('#dg').datagrid('reload');
        }
        //弹出定时关闭的消息框
        function alert_autoClose(title, msg, icon) {
            var interval;
            var time = 500;
            var x = 1;  //只接受整数
            $.messager.alert(title, msg, icon, function () { });
            interval = setInterval(fun, time);
            function fun() {
                --x;
                if (x == 0) {
                    clearInterval(interval);
                    $(".messager-body").window('close');
                }
            };
        }
        var LODOP;

    </script>

</asp:Content>
