<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Main.aspx.cs" Inherits="Supplier.Main" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1" runat="server">
    <title>
        <%= Supplier.Common.GetSystemNameAndVersion()%></title>
    <link rel="shortcut icon" type="image/x-icon" href="CSS/image/jh.ico" media="screen" />
    <link href="JS/easy/css/default/easyui.css" rel="stylesheet" type="text/css" />
    <link href="JS/easy/css/icon.css" rel="stylesheet" type="text/css" />
    <link href="CSS/default.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .header {
            background: linear-gradient(to bottom, #eff5ff 0px, #e0ecff 100%) repeat-x scroll 0 0 rgba(0, 0, 0, 0);
        }
    </style>

    <script src="JS/easy/js/jquery.min.js" type="text/javascript"></script>

    <script src="JS/easy/js/jquery.easyui.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        var _menus = {};
        $(document).ready(function () {
            _menus = <%=res%>;
        });

    </script>

    <script src="JS/easy/js/easyui-lang-zh_CN.js" type="text/javascript"></script>

    <script src="JS/lefttree.js" type="text/javascript"></script>

    <script src="JS/Date/ComJs.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            width = Number($(window).width())/2;
            height = Number($(window).height())/2;
            $('#dgNotice').datagrid({
                width: width,
                height: height,
                title: '<span style=color:red;font-size:15px;>公告通知</span>',
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: true, //行高是否自动
                collapsible: true, //是否可折叠
                pagination: true, //分页是否显示
                fitColumns: true, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: true, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'ID',
                url: null,
                showFooter: true,
                toolbar: '#saPanel',
                columns: [[
                    {
                        title: '消息类型', field: 'NoticeType', width: '80px', align: 'center', formatter: function (val) {
                            if (val == "0") { return "<span title='系统公告'>系统公告</span>"; }
                            else if (val == "1") { return "<span title='到货通知'>到货通知</span>"; }
                            else { return ""; }
                        }
                    },
                    {
                        title: '消息标题', field: 'Title', width: '350px', align: 'center', formatter: function (value) {
                            return "<span title='" + value + "'>" + value + "</span>";
                        }
                    },
                    {
                        title: '阅读状态', field: 'ReadStatus', width: '80px', align: 'center',
                        formatter: function (val, row, index) {
                            if (val == "0") { return "<span title='未读'>未读</span>"; }
                            else if (val == "1") { return "<span title='已读'>已读</span>"; }
                            else { return ""; }
                        }
                    },
                    { title: '消息时间', field: 'OP_DATE', width: '150px', align: 'center', formatter: DateTimeFormatter }
                ]],
                rowStyler: function (index, row) {
                    if (row.ReadStatus == "0") {
                        return "background-color:#F4982C;font-weight: bold;";
                    }
                },
                onClickRow: function (index, row) {
                    editItemByID(index);
                }
            });
            //QueryWarnStock()
        });
        ////查询
        //function QueryWarnStock() {
        //    $('#dgNotice').datagrid('clearSelections');
        //    var gridOpts = $('#dgNotice').datagrid('options');
        //    gridOpts.url = '../FormService.aspx?method=QueryCargoNotice';
        //    $('#dgNotice').datagrid('load', {
        //        Title: $('#ATitle').val()
        //    });
        //}
    </script>
</head>
<body class="easyui-layout">
    <div data-options="region:'north',border:false" class="header" style="height: 40px;">
        <div style="display: inline; padding-left: 10px; font-size: 25px; font-weight: bolder; font-family: 微软雅黑,黑体,宋体;">
             <%= Supplier.Common.GetSystemNameAndVersion()%>
        </div>
        <div style="display: inline; position: absolute; top: 10px; text-align: right; right: 10px; font-size: 14px;">
            <asp:Literal ID="welcome" runat="server"></asp:Literal>
            <a href="#" class="easyui-linkbutton" iconcls="icon-eye" plain="true" onclick="ChangePaw()">&nbsp;修改密码&nbsp;</a>&nbsp;&nbsp;
            <a href="#" class="easyui-linkbutton" iconcls="icon-shield" plain="true" onclick="Quit()"> &nbsp;退&nbsp;出&nbsp;</a>
        </div>
    </div>
    <div data-options="region:'west',split:true" style="width: 150px;">
        <div id="wnav" class="easyui-accordion" fit="true" border="false">
        </div>
    </div>
    


    <div data-options="region:'center'" style="width: 100%; height: 100%">
        <div id="tt" class="easyui-tabs" data-options="fit:true">
            <div title="首页">
            </div>
        </div>
    </div>
    <div id="dlg" class="easyui-dialog" style="width: 330px; height: 230px; padding: 5px 5px"
        closed="true" buttons="#dlg-buttons">
        <table>
            <tr>
                <td style="text-align: right;">切换仓库:
                </td>
                <td>
                    <input id="HouseID" name="HouseID" class="easyui-combobox" style="width: 150px;" />
                </td>
            </tr>
        </table>

    </div>
    <div id="dlg-buttons">
        <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="saveItem()">&nbsp;确&nbsp;定&nbsp;</a>
        <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">&nbsp;取&nbsp;消&nbsp;</a>
    </div>
    <script type="text/javascript">
        function Quit() { window.location = "Default.aspx"; }
        function ChangePaw() { addTab("修改密码", "../ChangePassword.aspx", "icon-eye"); }
        function changeHouse() {
            $('#dlg').dialog('open').dialog('setTitle', '切换仓库');
            $('#fm').form('clear');
            //所在仓库
            $('#HouseID').combobox({
                url: '../FormService.aspx?method=CargoPermisionHouse',
                valueField: 'ID', textField: 'SettleHouseName'
            });
        }
        function saveItem() {
            var ID = $('#HouseID').combobox('getValue');
            var SettleHouseName = $('#HouseID').combobox('getText');
            if (ID == undefined || ID == '') {
                $.messager.alert('<%= Supplier.Common.GetSystemNameAndVersion()%>', '请选择要切换的仓库', 'warning');
                return;
            }
            $.messager.confirm('<%= Supplier.Common.GetSystemNameAndVersion()%>', '确定切换仓库？', function (r) {
                if (r) {
                    $.ajax({
                        url: '../FormService.aspx?method=ChangeHouse',
                        type: 'post', dataType: 'json', data: { ID: ID, SettleHouseName: SettleHouseName },
                        success: function (text) {
                            //var result = eval('(' + msg + ')');
                            if (text.Result == true) {
                                $.messager.alert('<%= Supplier.Common.GetSystemNameAndVersion()%>', '切换成功!', 'info');
                                window.location.reload();
                            }
                            else {
                                $.messager.alert('<%= Supplier.Common.GetSystemNameAndVersion()%>', text.Message, 'warning');
                            }
                        }
                    });
                }
            });
        }
    </script>

</body>
</html>
