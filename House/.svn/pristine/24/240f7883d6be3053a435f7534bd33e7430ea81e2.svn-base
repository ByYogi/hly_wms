<%@ Page Title="云仓数据" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="huiCaiWarehouseStatistics.aspx.cs" Inherits="Cargo.HuiCai.huiCaiWarehouseStatistics" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <link href="../JS/FloatNavi/base.css" rel="stylesheet" />
    <script src="../JS/FloatNavi/common.js" type="text/javascript"></script>
    <script src="../JS/EChart/chart.umd.js" type="text/javascript"></script>
    <script src="../JS/EChart/chartjs-plugin-datalabels.min.js" type="text/javascript"></script>
    <style type="text/css">
    </style>

    <script type="text/javascript">
        $(function () {
            //InitTab();
            $('#dgHouseAim').datagrid({
                width: '100%',
                height: '570px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                rownumbers: true,
                columns: [[
                    { title: '仓库名称', field: 'HouseName', width: '70px' },
                    {
                        title: '年月', field: 'AimMonth', width: '60px', align: 'right', formatter: function (val, item) {
                            return item.AimYear + "-" + item.AimMonth
                        }
                    },
                    { title: '销售数量', field: 'Piece', width: '60px', align: 'right' },
                    { title: '销售目标（月）', field: 'AimQuantity', width: '90px', align: 'right' },
                    {
                        title: '完成百分比', field: 'PercentComplete', width: '80px', align: 'right', formatter: function (val) {

                            return val + "%"
                        }
                    },
                ]],
                onClickRow: function (index, row) {
                    $('#dgHouseAim').datagrid('clearSelections');
                    $('#dgHouseAim').datagrid('selectRow', index);
                },
            });
            $('#dgOrderDayStatistics').datagrid({
                width: '100%',
                height: '600px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                rownumbers: true,
                columns: [[
                    { title: '品牌名称', field: 'TypeName', width: '110px' },
                    { title: '仓库名称', field: 'HouseName', width: '110px' },
                    { title: '销量', field: 'Piece', width: '110px', align: 'right' },
                    { title: '销售SKU', field: 'DayStatisticsCount', width: '110px', align: 'right' },
                    { title: '目标SKU', field: 'StockNum', width: '110px', align: 'right' },
                    { title: '在库SKU', field: 'ProCount', width: '110px', align: 'right' },
                    { title: '库存', field: 'ProPiece', width: '110px', align: 'right' },
                    {
                        title: 'SKU满足率', field: 'SatisfactionRate', width: '110px', align: 'right', formatter: function (val) {

                            return val + "%"
                        }
                    },
                    {
                        title: '动销率', field: 'SalesRate', width: '110px', align: 'right', formatter: function (val) {

                            return val + "%"
                        }
                    },
                    {
                        title: '库存周转数', field: 'InventoryTurnover', width: '110px', align: 'right'
                    },
                    {
                        title: '点击转化率', field: 'ClickConversionRate', width: '110px', align: 'right', formatter: function (val) {

                            return val + "%"
                        }
                    },

                ]],
                onClickRow: function (index, row) {
                    $('#dgOrderDayStatistics').datagrid('clearSelections');
                    $('#dgOrderDayStatistics').datagrid('selectRow', index);
                },
            });

            var url = '../Order/orderApi.aspx?method=QueryALLBrandType&type=edit';
            $('#TypeID').combobox('reload', url);
        });




    </script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div style="font-size: 30px; font-weight: bold; background-color: white;">
        <div id="saPanel" name="SelectDiv1" class="easyui-panel" title="" data-options="iconCls:'icon-search'" style="width: 100%">
            <table id="saPanelTab">
                <tr>
                    <td style="text-align: right;">订单时间:
                    </td>
                    <td>
                        <input id="StartDate" class="easyui-datebox" style="width: 100px" />~<input id="EndDate" class="easyui-datebox" style="width: 100px" />
                    </td>
                    <td style="text-align: right;">订单类型:
                    </td>
                    <td>
                        <select class="easyui-combobox" id="OrderType" style="width: 100px" panelheight="auto">
                            <option value="0">全部</option>
                            <option value="22">即日达</option>
                            <option value="23">次日达</option>
                        </select>
                    </td>
                    <td><a href="#" class="easyui-linkbutton" iconcls="icon-search" plain="false" onclick="DoSearch()">&nbsp;查&nbsp;询&nbsp;</a>&nbsp;&nbsp;</td>
                </tr>
            </table>
        </div>
    </div>
    <div id="saPanel" style="font-weight: bold; background-color: white; padding-bottom: 3px; padding-top: 3px; margin-top: 5px;">
        <table style="text-align: center;">
            <tr>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">用户数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="UserCount">15</span>
                </td>

                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">门店数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="StoresCount">15</span>

                </td>

                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">销量(条)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="MonthOrderSalesVolume">0</span>
                        <br style="line-height: 5px;" />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">目标完成:<span style="font-size: 15px; font-weight: bold; color: #ed2323;" id="DayOrderSalesVolume">0</span></span>

                    </div>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">销售额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #2E8B57;" id="MonthOrderRevenue">0</span>
                    <br style="line-height: 5px;" />
                    <%--<span style="font-weight: lighter; font-size: 13px; color: #808080">日销额:<span style="font-size: 15px; font-weight: bold; color: #2E8B57;" id="DayOrderRevenue">0</span></span>--%>
                </td>

                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">退货量(条)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="ReturnPiece">0</span>
                        <br style="line-height: 5px;" />
                        <%--<span style="font-weight: lighter; font-size: 13px; color: #808080">日退货量:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderDayPiece">0</span></span>--%>
                    </div>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">退货额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="ReturnTotalCharge">0</span>
                    <br style="line-height: 5px;" />
                    <%--<span style="font-weight: lighter; font-size: 13px; color: #808080">日销额:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderDayCharge">0</span></span>--%>
                </td>
            </tr>
            <tr>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080;">访问用户数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="DayUserCount">0</span>
                </td>

                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">访问门店数</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="DayClientCount">0</span>
                </td>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">交易用户数</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #2E8B57;" id="DayClickCount">0</span>
                </td>

                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">交易门店数</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="StoresUniqueClientCount">0</span>
                        <br style="line-height: 5px;" />
                        <%--<span style="font-weight: lighter; font-size: 13px; color: #808080">交易门店数:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="ReturnOrderDayPiece">0</span></span>--%>
                    </div>
                </td>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">浏览数(次)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1cdb14;" id="MonthClickCount">0</span>

                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">总销量(条)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1cdb14;" id="TotalPiece">0</span></td>
            </tr>
        </table>


    </div>
    <div style="width: 100%; height: 100%;" id="ChartBox">
        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 24%;" id="pn23" data-options="tools:'#tl1'" class="easyui-panel" title="仓库交易数据">

                <table id="dgHouseAim" class="easyui-datagrid">
                </table>
                <div id="tl1">
                    <%--<span href="#" class="easyui-linkbutton" iconcls="icon-application_put" plain="false" onclick="DayStatisticsExportV2()" id="btnExportV2">&nbsp;导&nbsp;出&nbsp;</span>--%>&nbsp;&nbsp;
                    <a href="javascript:void(0)" class="icon-application_get" onclick="DayStatisticsExportV2()" title="导出"></a>
                </div>
            </div>
            <div style="width: 76%;">
                <canvas id="canvBrandBar"></canvas>
            </div>
        </div>
        <div style="width: 100%; display: flex;">
            <div style="width: 100%;">
                <canvas id="TotalMonthBar"></canvas>
            </div>

        </div>
        <div style="width: 100%; display: flex;">
            <div style="width: 100%;" id="pn23" class="easyui-panel" title="品牌月销售排名统计数">
                <table id="saPanelTab">
                    <tr>
                        <td style="text-align: right;">日期:
                        </td>
                        <td>
                            <input id="TypeStartDate" class="easyui-datebox" style="width: 100px" />~<input id="TypeEndDate" class="easyui-datebox" style="width: 100px" />
                        </td>
                        <td style="text-align: right;">品牌:
                        </td>
                        <td>
                            <input id="TypeID" name="TypeID" class="easyui-combobox" style="width: 100px;" data-options="valueField:'TypeID',textField:'TypeName',editable:true,required:true" />
                        </td>
                        <td style="text-align: right;">供应商:
                        </td>
                        <td>
                            <input id="ASettleHouseID" class="easyui-combobox" style="width: 100px;" />
                        </td>
                        <td><span href="#" class="easyui-linkbutton" iconcls="icon-search" plain="false" onclick="DoSearchBrand()">&nbsp;查&nbsp;询&nbsp;</span>&nbsp;&nbsp;</td>
                        <td><span href="#" class="easyui-linkbutton" iconcls="icon-application_put" plain="false" onclick="DayStatisticsExport()" id="btnExport">&nbsp;导&nbsp;出&nbsp;</span>&nbsp;&nbsp;
                             <form runat="server" id="Form2">
                                 <asp:Button ID="btnDerived" runat="server" Style="display: none;" Text="导出" OnClick="btnDerived_Click" />
                                 <asp:Button ID="btnDerived2" runat="server" Style="display: none;" Text="导出" OnClick="btnDerived2_Click" />
                             </form>

                        </td>
                    </tr>
                </table>
                <table id="dgOrderDayStatistics" class="easyui-datagrid">
                </table>
            </div>

        </div>


        <script type="text/javascript">
            var CharTable = $(".CharTable")
            $(CharTable[0]).css("display", "")



            Chart.register(ChartDataLabels);

            var UserBar = document.getElementById('UserBar');
            var UserBarChart = new Chart(UserBar, {
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: '增加数',
                        data: [12, 95, 45, 78, 96, 31],
                        type: 'bar',
                    }]
                },
                options: {
                    plugins: {
                        datalabels: {
                            display: function (context) {
                                if (context.datasetIndex == 0) {
                                    return true
                                }
                                else {
                                    return false
                                }
                            },

                            color: 'Black',
                            font: {
                                weight: 'bold',
                                size: 15,
                            },
                            anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                            //align: 'top', // 设置标签的对齐位置（相对于锚点）
                            //formatter: function (value) {
                            //    return value;
                            //}
                        },

                        //legend: {
                        //    position: 'top',
                        //},
                        title: {
                            display: true,
                            text: '每日用户增长统计',
                            font: {
                                size: 15
                            }
                        }

                    },

                }
            });

            //交易柱状图
            var canvBrandBar = document.getElementById('canvBrandBar');
            var canvBrandBarChart = new Chart(canvBrandBar, {
                data: {
                    labels: [],
                    datasets: [{
                        label: '交易量',
                        data: [],
                        type: 'bar',
                    }]
                },
                options: {
                    plugins: {
                        datalabels: {
                            color: 'Black',
                            font: {
                                weight: 'bold',
                                size: 15,
                            },
                            anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                            //align: 'top', // 设置标签的对齐位置（相对于锚点）
                            //formatter: function (value) {
                            //    return value;
                            //}
                        },
                        //legend: {
                        //    position: 'top',
                        //},
                        title: {
                            display: true,
                            text: '仓库交易数据',
                            font: {
                                size: 15
                            }
                        }

                    },

                }
            });

            //月总销售柱状图
            var canvTotalMonthBar = document.getElementById('TotalMonthBar');
            var canvTotalMonthChart = new Chart(canvTotalMonthBar, {
                data: {
                    labels: [],
                    datasets: [{
                        label: '月总销售条数',
                        data: [],
                        type: 'bar',
                    }]
                },
                options: {
                    plugins: {
                        datalabels: {
                            color: 'Black',
                            font: {
                                weight: 'bold',
                                size: 15,
                            },
                            anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                            //align: 'top', // 设置标签的对齐位置（相对于锚点）
                            //formatter: function (value) {
                            //    return value;
                            //}
                        },
                        //legend: {
                        //    position: 'top',
                        //},
                        title: {
                            display: true,
                            text: '月总销售数据',
                            font: {
                                size: 15
                            }
                        }

                    },

                }
            });


            $(function () {

                var windowHeight = $(window).height() - 150;
                //$(".Chart").css("height", windowHeight)
                var datenow = new Date();

                $('#StartDate').datebox('setValue', getNowFormatDate(datenow.getFullYear().toString() + "-" + (datenow.getMonth() + 1).toString() + "-01"));
                $('#EndDate').datebox('setValue', getNowFormatDate(datenow));

                $('#TypeStartDate').datebox('setValue', getNowFormatDate(datenow.getFullYear().toString() + "-" + (datenow.getMonth() + 1).toString() + "-01"));
                $('#TypeEndDate').datebox('setValue', getNowFormatDate(datenow));

                $('#ASettleHouseID').combobox({
                    url: '../Client/clientApi.aspx?method=AutoCompleteClient&SettleHouseID=1', valueField: 'ClientNum', textField: 'ClientShortName', AddField: 'PinyinName',
                    filter: function (q, row) {
                        var opts = $(this).combobox('options');
                        return row[opts.textField].indexOf(q) >= 0 || row[opts.AddField].indexOf(q) >= 0;
                    },
                });
                $('#OrderType').combobox('textbox').bind('focus', function () { $('#OrderType').combobox('showPanel'); });
                //$('#HouseID').combobox({
                //    url: '../House/houseApi.aspx?method=CargoPermisionHouse', valueField: 'HouseID', textField: 'Name'
                //});
                RELOAD();
            });
            function RELOAD() {
                var alternatingColors = ['rgba(174,238,238,05)', 'rgba(118,238,198,0.5)'];
                var StoresalternatingColors = ['rgba(175,238,238,0.5)', 'rgba(64,224,208,0.5)'];

                var DayOrderalternatingColors = ['rgba(255,106,106,0.5)', 'rgba(238,99,99,0.5)'];
                //var DayOrderSalesVolumealternatingColors = ['rgba(224,255,255,0.5)', 'rgba(127,255,212,0.5)'];
                var DayOrderSalesVolumealternatingColors = ['#ff7f50', '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500'
                    , '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee', '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0', '#ff7f50'
                    , '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee'
                    , '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0', '#ff7f50'
                    , '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee'
                    , '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0', '#ff7f50'
                    , '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee'
                    , '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0', '#ff7f50'
                    , '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee'
                    , '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0', '#ff7f50'
                    , '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee'
                    , '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0'];

                var DayOrderRevenuealternatingColors = ['rgba(135,206,250,0.5)', 'rgba(127,255,212,0.5)'];

                $.ajax({
                    type: 'post',
                    url: "huiCaiApi.aspx?method=HCYCStatisticsData",
                    data: {
                        //HouseID: $('#HouseID').combobox('getValue'),
                        StartDate: $('#StartDate').datebox('getValue'),
                        EndDate: $('#EndDate').datebox('getValue'),
                    },
                    success: function (data) {
                        var newData = JSON.parse(data);
                        $("#UserCount").text(newData.Users.Count)
                        $("#UserDayCount").text(newData.Users.DayCount)
                        $("#UserMonthCount").text(newData.Users.MonthCount)

                        $("#StoresCount").text(newData.Stores.Count)
                        $("#StoresDayCount").text(newData.Stores.DayCount)
                        $("#StoresMonthCount").text(newData.Stores.MonthCount)

                        $("#DayOrderNum").text(newData.Order.DayOrderNum)
                        $("#DayOrderRevenue").text(newData.Order.DayOrderRevenue)
                        $("#MonthOrderNum").text(newData.Order.MonthOrderNum)
                        $("#MonthOrderRevenue").text((newData.Order.SalesTotalCharge / 10000).toFixed(2))
                        var ttoal = 0;
                        if (parseInt(newData.Order.SalesPiece) == 0 || parseInt(newData.Order.MonthHouseTotalPiece) == 0) {
                            ttoal = 0;
                        } else {
                            ttoal = parseInt(newData.Order.SalesPiece) / parseInt(newData.Order.MonthHouseTotalPiece) * 100
                        }
                        console.log(parseInt(newData.Order.SalesPiece), parseInt(newData.Order.MonthHouseTotalPiece))
                        $("#DayOrderSalesVolume").text(newData.Order.MonthHouseTotalPiece + "(" + ttoal.toFixed(2) + "%)")
                        $("#MonthOrderSalesVolume").text(newData.Order.SalesPiece)
                        $("#ReturnPiece").text(newData.Order.ReturnPiece)
                        $("#ReturnTotalCharge").text((newData.Order.ReturnTotalCharge / 10000).toFixed(2))
                        $("#TotalPiece").text((newData.Order.TotalPiece))

                        $("#TotalNum").text(newData.Order.TotalNum)

                        $("#ReturnOrderDayPiece").text(newData.Order.ReturnOrderDayPiece)

                        $("#OESSaleOrderDayPiece").text(newData.Order.OESSaleOrderDayPiece)
                        $("#ReturnOrderMonthCharge").text((newData.Order.ReturnOrderMonthCharge / 10000).toFixed(2))
                        $("#ReturnOrderDayCharge").text((newData.Order.ReturnOrderDayCharge / 10000).toFixed(2))
                        $("#OESSaleOrderDayCharge").text((newData.Order.OESSaleOrderDayCharge / 10000).toFixed(2))

                        // 循环遍历数据集，为每个柱状图设置交替的颜色


                        var Userlabels = [];
                        var Userdatas = {
                            data: [],
                            label: '增长数',
                            type: 'bar',
                            backgroundColor: [],
                            borderColor: [],
                        }
                        var UserdataLien = {
                            data: [],
                            label: '',
                            type: 'line',
                            fill: false,
                            borderColor: [],
                            backgroundColor: '#FF6A6A',
                        }
                        for (var i = 0; i < newData.Statistics.User.length; i++) {
                            Userlabels.push(newData.Statistics.User[i].Date)
                            Userdatas.data.push(newData.Statistics.User[i].Num)
                            UserdataLien.data.push(newData.Statistics.User[i].Num)
                        }
                        Userlabels.label = "增长数";
                        var len = UserBarChart.data.datasets.length
                        for (var i = 0; i < len; i++) {
                            UserBarChart.data.datasets.pop();
                        }
                        UserBarChart.data.datasets.pop();
                        UserBarChart.data.labels = Userlabels;
                        Userdatas.data.forEach((dataset, index) => {
                            var colorIndex = index % alternatingColors.length;
                            Userdatas.backgroundColor.push(alternatingColors[colorIndex]);
                            Userdatas.borderColor.push(alternatingColors[colorIndex]);
                            UserdataLien.borderColor.push('#FF6A6A');
                        });
                        UserBarChart.data.datasets.push(UserdataLien);
                        UserBarChart.data.datasets.push(Userdatas);

                        UserBarChart.update();
                        console.log(UserBarChart.data.datasets)


                    }
                });
                $.ajax({
                    type: 'post',
                    url: "huiCaiApi.aspx?method=HCYCAccessStatisticsData",
                    data: {
                        //HouseID: $('#HouseID').combobox('getValue'),
                        StartDate: $('#StartDate').datebox('getValue'),
                        EndDate: $('#EndDate').datebox('getValue'),
                    },
                    success: function (data) {
                        var newData = JSON.parse(data);
                        $("#DayUserCount").text(newData.Users.DayUserCount);
                        $("#DayClientCount").text(newData.Users.DayClientCount);
                        $("#DayClickCount").text(newData.Users.DayClickCount);
                        $("#MonthClickCount").text(newData.Users.MonthClickCount);
                        $("#StoresUniqueClientCount").text(newData.Users.StoresUniqueClientCount)
                    }
                });

                $.ajax({
                    type: 'post',
                    url: "huiCaiApi.aspx?method=QueryHCYC_House",
                    data: {
                        StartDate: $('#StartDate').datebox('getValue'),
                        EndDate: $('#EndDate').datebox('getValue'),
                        OrderType: $('#OrderType').combobox('getValue'),
                    },
                    success: function (dt) {
                        var data = eval(dt);
                        $('#dgHouseAim').datagrid('loadData', data);
                        var brandLabels = [];
                        var brandSalesVolumedatas = {
                            data: [],
                            label: '仓库交易数',
                            type: 'bar',
                            borderColor: [],
                            backgroundColor: [],
                        }
                        var sum = 0;
                        for (var j = 0; j < data.length; j++) {
                            //sum += data[j].OrderPiece
                        }
                        for (var i = 0; i < data.length; i++) {
                            brandLabels.push(data[i].HouseName);
                            brandSalesVolumedatas.data.push(data[i].Piece);
                            brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                            brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                        }
                        canvBrandBarChart.data.datasets.pop();
                        canvBrandBarChart.data.labels = brandLabels;
                        canvBrandBarChart.data.datasets.push(brandSalesVolumedatas);
                        canvBrandBarChart.update();

                    }
                });

                //$.ajax({
                //    type: 'post',
                //    url: "huiCaiApi.aspx?method=QueryHCYC_OrderDayStatistics",
                //    data: {
                //        StartDate: $('#StartDate').datebox('getValue'),
                //        EndDate: $('#EndDate').datebox('getValue'),
                //    },
                //    success: function (dt) {
                //        var data = eval(dt);
                //        $('#dgOrderDayStatistics').datagrid('loadData', data);
                //    }
                //});

                $.ajax({
                    type: 'post',
                    url: "huiCaiApi.aspx?method=QueryHCYC_TotalMonth",
                    data: {
                        StartDate: $('#StartDate').datebox('getValue'),
                        EndDate: $('#EndDate').datebox('getValue'),
                        OrderType: $('#OrderType').combobox('getValue'),
                    },
                    success: function (dt) {
                        var data = eval(dt);
                        var brandLabels = [];
                        var datestr = new Date($('#EndDate').datebox('getValue'));
                        var MonthStr = datestr.getMonth() + 1
                        var brandSalesVolumedatas = {
                            data: [],
                            label: MonthStr + '月总销售数',
                            type: 'bar',
                            borderColor: [],
                            backgroundColor: [],
                        }
                        for (var i = 0; i < data.length; i++) {
                            brandLabels.push(data[i].Day + '号');
                            brandSalesVolumedatas.data.push(data[i].Piece);
                            brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                            brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                        }
                        canvTotalMonthChart.data.datasets.pop();
                        canvTotalMonthChart.data.labels = brandLabels;
                        canvTotalMonthChart.data.datasets.push(brandSalesVolumedatas);
                        canvTotalMonthChart.update();

                    }
                });


            }
            function IsEmpty(value) {
                // 检查 null/undefined
                if (value == null) return true;

                // 检查空字符串/纯空格
                if (typeof value === 'string' && value.trim() === '') return true;

                // 检查空数组
                if (Array.isArray(value) && value.length === 0) return true;

                // 检查空对象
                if (value.constructor === Object && Object.keys(value).length === 0) return true;

                return false;

            }
            function DoSearch() {
                var StartDate = $('#StartDate').datebox('getValue')
                var EndDate = $('#EndDate').datebox('getValue')
                if (IsEmpty(StartDate) || IsEmpty(EndDate)) {
                    $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '日期不能为空！', 'warning'); return;
                }
                var time1 = new Date(StartDate)
                var time2 = new Date(EndDate)
                if (time1 > time2) {
                    $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '开始日期不能大于结束日期！', 'warning'); return;
                }
                RELOAD();
            }
            function DoSearchBrand() {
                var StartDate = $('#TypeStartDate').datebox('getValue')
                var EndDate = $('#TypeEndDate').datebox('getValue')
                var time1 = new Date(StartDate)
                var time2 = new Date(EndDate)
                if (time1 > time2) {
                    $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '开始日期不能大于结束日期！', 'warning'); return;
                }
                showLoading();
                GetBrandData();
            }
            function GetBrandData() {
                var typeid = $('#TypeID').combobox('getValue')
                if (typeid == "" || typeid == null) {
                    hideLoading();
                    $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '请选择品牌！', 'warning'); return;
                }
                //showLoading();
                $.ajax({
                    type: 'post',
                    url: "huiCaiApi.aspx?method=QueryHCYC_BrandData",
                    data: {
                        StartDate: $('#TypeStartDate').datebox('getValue'),
                        EndDate: $('#TypeEndDate').datebox('getValue'),
                        TypeID: typeid,
                        SuppClientNum: $('#ASettleHouseID').combobox('getValue'),
                        OrderType: $('#OrderType').combobox('getValue'),
                    },
                    success: function (dt) {
                        hideLoading();
                        var data = eval(dt);
                        $('#dgOrderDayStatistics').datagrid('loadData', data);
                    }
                });
            }
            function DayStatisticsExport() {
                var key = {
                    StartDate: $('#TypeStartDate').datebox('getValue'),
                    EndDate: $('#TypeEndDate').datebox('getValue'),
                    TypeID: $('#TypeID').combobox('getValue'),
                    SuppClientNum: $('#ASettleHouseID').combobox('getValue'),
                    OrderType: $('#OrderType').combobox('getValue'),
                }

                $.ajax({
                    url: "huiCaiApi.aspx?method=DayStatisticsExport",
                    type: 'post', data: key,
                    success: function (text) {
                        console.log(text)
                        if (text == "OK") {
                            var obj = document.getElementById("<%=btnDerived.ClientID %>");
                            obj.click();
                        }
                        else { $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', text, 'warning'); }
                    }
                });
            }
            function DayStatisticsExportV2() {
                var key = {
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                    OrderType: $('#OrderType').combobox('getValue'),
                }

                $.ajax({
                    url: "huiCaiApi.aspx?method=DayStatisticsExportV2",
                    type: 'post', data: key,
                    success: function (text) {
                        console.log(text)
                        if (text == "OK") {
                            var obj = document.getElementById("<%=btnDerived2.ClientID %>");
                            obj.click();
                        }
                        else { $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', text, 'warning'); }
                    }
                });
            }
            function showLoading() {
                $.messager.progress({
                    title: '请稍候',
                    msg: '正在加载数据...',
                    text: ''
                });
            }
            // 隐藏加载动画
            function hideLoading() {
                $.messager.progress('close');
            }

        </script>
</asp:Content>
