<%@ Page Title="" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="reportHCYCStatis.aspx.cs" Inherits="Cargo.Report.reportHCYCStatis" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <link href="../JS/FloatNavi/base.css" rel="stylesheet" />
    <script src="../JS/FloatNavi/common.js" type="text/javascript"></script>
    <script src="../JS/EChart/chart.umd.js" type="text/javascript"></script>
    <script src="../JS/EChart/chartjs-plugin-datalabels.min.js" type="text/javascript"></script>
    <style type="text/css">
    </style>

    <script type="text/javascript">
        $(function () {
            $('#dgBrand').datagrid({
                width: '100%',
                height: '450px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                showFooter: true,
                url: null,
                rownumbers: true,
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '70px' },
                    { title: '销售量(条)', field: 'OrderPiece', width: '80px', align: 'right' },
                    { title: '销售额(元)', field: 'OrderCharge', width: '80px', align: 'right' },
                    { title: '单条价值(元)', field: 'UnitCharge', width: '80px', align: 'right' },
                ]],
                onClickRow: function (index, row) {
                    $('#dgBrand').datagrid('clearSelections');
                    $('#dgBrand').datagrid('selectRow', index);
                },
            });
            $('#dgBrandTop30').datagrid({
                width: '100%',
                height: '500px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                showFooter: true,
                rownumbers: true,
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '60px' },
                    { title: '规格', field: 'Specs', width: '80px' },
                    { title: '花纹', field: 'Figure', width: '100px' },
                    { title: '销售量(条)', field: 'OrderPiece', width: '65px', align: 'right' },
                    { title: '单条价值(元)', field: 'UnitCharge', width: '70px', align: 'right' },
                ]],
                onClickRow: function (index, row) {
                    $('#dgBrandTop30').datagrid('clearSelections');
                    $('#dgBrandTop30').datagrid('selectRow', index);
                },
            });
            $('#dgDayAccessStatis').datagrid({
                width: '100%',
                height: '500px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                pagination: true,
                rownumbers: true,
                pageSize: 100,                       // 默认每页条数
                pageList: [100, 200, 500],             // 可选每页条数
                idField: 'TypeName',
                url: null,
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '60px' },
                    { title: '规格', field: 'Specs', width: '80px' },
                    { title: '花纹', field: 'Figure', width: '100px' },
                    {
                        title: '载速', field: 'LoadIndex', width: '70px', formatter: function (value, row) {
                            return row.LoadIndex + row.SpeedLevel;
                        }
                    },
                    { title: '门店名称', field: 'CompanyName', width: '90px' },
                    { title: '联系人', field: 'Name', width: '70px' },
                    { title: '手机号', field: 'Cellphone', width: '80px' },
                    { title: '浏览时间', field: 'AccessDate', width: '130px', formatter: DateTimeFormatter },
                ]],
                onClickRow: function (index, row) {
                    $('#dgDayAccessStatis').datagrid('clearSelections');
                    $('#dgDayAccessStatis').datagrid('selectRow', index);
                },
                rowStyler: function (index, row) {
                    if (row.FeedBackStatus == "1") { return "background-color:#c7ffda"; }
                    //else if (row.InCargoStatus == "1" && row.ContainerCode == "") { return "background-color:#EBEBEB"; }
                }
            });
            $('#dgSevenDayOrder').datagrid({
                width: '100%',
                height: '500px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                pagination: true,
                rownumbers: true,
                showFooter: true,
                pageSize: 100,                       // 默认每页条数
                pageList: [100, 200, 500],             // 可选每页条数
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '55px' },
                    { title: '规格', field: 'Specs', width: '80px' },
                    { title: '花纹', field: 'Figure', width: '90px' },
                    {
                        title: '载速', field: 'LoadIndex', width: '70px', formatter: function (value, row) {
                            if (row.TypeName == "汇总：") return '';
                            return row.LoadIndex + row.SpeedLevel;
                        }
                    },
                    { title: '门店名称', field: 'ClientName', width: '90px' },
                    { title: '销量(条)', field: 'OrderPiece', width: '60px', align: 'right' },
                    { title: '下单时间', field: 'CreateDate', width: '8px', formatter: DateFormatter },
                ]],
                onClickRow: function (index, row) {
                    $('#dgSevenDayOrder').datagrid('clearSelections');
                    $('#dgSevenDayOrder').datagrid('selectRow', index);
                },
            });
            $('#dgBrandConverRate').datagrid({
                width: '100%',
                height: '450px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                showFooter: true,
                url: null,
                rownumbers: true,
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '90px' },
                    { title: '月浏览量', field: 'BrowseNum', width: '70px' },
                    { title: '下单量', field: 'OrderCount', width: '70px' },
                    { title: '下单销量', field: 'OrderPiece', width: '70px' },
                    {
                        title: '转化率', field: 'OrderNumRate', width: '60px', align: 'right', formatter: function (val, item) {
                            if (item.TypeName == "汇总：") return '';
                            return val + "%"
                        },
},
                ]],
                onClickRow: function (index, row) {
                    $('#dgBrandConverRate').datagrid('clearSelections');
                    $('#dgBrandConverRate').datagrid('selectRow', index);
                },
            });
            $('#dgClientConverRate').datagrid({
                width: '100%',
                height: '450px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                showFooter: true,
                rownumbers: true,
                columns: [[
                    { title: '门店名称', field: 'ClientName', width: '140px' },
                    { title: '月浏览量', field: 'BrowseNum', width: '60px' },
                    { title: '下单量', field: 'OrderCount', width: '60px' },
                    { title: '下单销量', field: 'OrderPiece', width: '60px' },
                    {
                        title: '转化率', field: 'OrderNumRate', width: '60px', align: 'right', formatter: function (val, item) {
                            if (item.ClientName == "汇总：") return '';
                            return val + "%"
                        }, },
                ]],
                onClickRow: function (index, row) {
                    $('#dgClientConverRate').datagrid('clearSelections');
                    $('#dgClientConverRate').datagrid('selectRow', index);
                },
            });
            $('#dgBrandSKUStatis').datagrid({
                width: '100%',
                height: '520px',
                title: '', //标题内容品牌SKU统计
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                showFooter: true,
                rownumbers: true,
                columns: [[
                    { title: '品牌', field: 'TypeName', width: '90px' },
                    { title: '实时库存(条)', field: 'SKUStockNum', width: '90px', align: 'right' },
                    { title: 'SKU总数(个)', field: 'SKUTotalNum', width: '90px', align: 'right' },
                    { title: '在库SKU(个)', field: 'InCargoSKUNum', width: '90px', align: 'right' },
                    { title: '已售SKU(个)', field: 'SaledSKUNum', width: '90px', align: 'right' },
                    { title: '动销率', field: 'SaledRatio', width: '90px', align: 'right' },
                ]],
                onClickRow: function (index, row) {
                    $('#dgBrandSKUStatis').datagrid('clearSelections');
                    $('#dgBrandSKUStatis').datagrid('selectRow', index);
                },
            });
            $('#dgKeyWordStatis').datagrid({
                width: '100%',
                height: '500px',
                title: '', //标题内容
                loadMsg: '数据加载中请稍候...',
                autoRowHeight: false, //行高是否自动
                collapsible: false, //是否可折叠
                pagination: false, //分页是否显示
                fitColumns: false, //设置为 true，则会自动扩大或缩小列的尺寸以适应网格的宽度并且防止水平滚动
                singleSelect: false, //设置为 true，则只允许选中一行。
                checkOnSelect: true, //如果设置为 true，当用户点击某一行时，则会选中/取消选中复选框。如果设置为 false 时，只有当用户点击了复选框时，才会选中/取消选中复选框
                idField: 'TypeName',
                url: null,
                pagination: true,
                rownumbers: true,
                pageSize: 100,                       // 默认每页条数
                pageList: [100, 200, 500],             // 可选每页条数
                columns: [[
                    { title: '门店名称', field: 'CompanyName', width: '100px' },
                    { title: '联系人', field: 'Name', width: '80px' },
                    { title: '手机号', field: 'Cellphone', width: '80px' },
                    { title: '搜索关键字', field: 'Specs', width: '80px' },
                    { title: '搜索品牌', field: 'TypeName', width: '70px' },
                    //{
                    //    title: '搜索结果', field: 'Figure', width: '70px', formatter: function (val, row, index) {
                    //        if (val == "0") { return "<span title='无库存'>无库存</span>"; }
                    //        else if (val == "1") { return "<span title='有库存'>有库存</span>"; }
                    //    }
                    //},
                    { title: '搜索时间', field: 'AccessDate', width: '130px', formatter: DateTimeFormatter },
                ]],
                onClickRow: function (index, row) {
                    $('#dgKeyWordStatis').datagrid('clearSelections');
                    $('#dgKeyWordStatis').datagrid('selectRow', index);
                },
            });
            //DoSearch();
        });

        function DoSearch() {
            $.messager.progress({ msg: '请稍后,正在查询中...' });
            RELOAD();
            $.messager.progress("close");
        }

    </script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div style="font-size: 30px; font-weight: bold; background-color: white;">
        <div id="saPanel" name="SelectDiv1" class="easyui-panel" title="" data-options="iconCls:'icon-search'" style="width: 100%">
            <table id="saPanelTab">
                <tr>
                    <td style="text-align: right;">所属仓库:
                    </td>
                    <td>
                        <input id="HouseID" name="HouseID" class="easyui-combobox" style="width: 100px;" data-options="valueField:'HouseID',textField:'HouseName'" />
                    </td>
                    <td style="text-align: right;">订单时间:
                    </td>
                    <td>
                        <input id="StartDate" class="easyui-datebox" style="width: 100px" />~<input id="EndDate" class="easyui-datebox" style="width: 100px" />
                    </td>
                    <td><a href="#" class="easyui-linkbutton" iconcls="icon-search" plain="false" onclick="DoSearch()">&nbsp;查&nbsp;询&nbsp;</a>&nbsp;&nbsp;</td>
                </tr>
            </table>
        </div>
    </div>
    <div id="saPanel" style="font-weight: bold; background-color: white; padding-bottom: 3px; padding-top: 3px; margin-top: 5px;">
        <table style="text-align: center;">
            <tr>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">用户数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="UserCount">15</span>
                    <div>
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">月增加:<span style="font-size: 15px; font-weight: bold; color: #1ea7f7;" id="UserMonthCount">2</span></span>
                        <br />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">日增加:<span style="font-size: 15px; font-weight: bold; color: #1ea7f7;" id="UserDayCount">2</span></span>

                    </div>
                </td>

                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">门店数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="StoresCount">15</span>
                    <div>
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">月增加:<span style="font-size: 15px; font-weight: bold; color: #1ea7f7;" id="StoresMonthCount">1</span></span>
                        <br />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">日增加:<span style="font-size: 15px; font-weight: bold; color: #1ea7f7;" id="StoresDayCount">0</span></span>
                    </div>
                </td>


                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">月订单数(个)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="MonthOrderNum">0</span>
                    <br style="line-height: 5px;" />
                    <span style="font-weight: lighter; font-size: 13px; color: #808080">日订单:<span style="font-size: 15px; font-weight: bold; color: #ed2323;" id="DayOrderNum">0</span></span>
                </td>
                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">月销量(条)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="MonthOrderSalesVolume">0</span>
                        <br style="line-height: 5px;" />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">日销量:<span style="font-size: 15px; font-weight: bold; color: #ed2323;" id="DayOrderSalesVolume">0</span></span>

                    </div>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">月销售额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #2E8B57;" id="MonthOrderRevenue">0</span>
                    <br style="line-height: 5px;" />
                    <span style="font-weight: lighter; font-size: 13px; color: #808080">日销额:<span style="font-size: 15px; font-weight: bold; color: #2E8B57;" id="DayOrderRevenue">0</span></span>
                </td>

                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">OES月销量(条)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderMonthPiece">0</span>
                        <br style="line-height: 5px;" />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">日销量:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderDayPiece">0</span></span>

                    </div>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">OES月销售额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderMonthCharge">0</span>
                    <br style="line-height: 5px;" />
                    <span style="font-weight: lighter; font-size: 13px; color: #808080">日销额:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="OESSaleOrderDayCharge">0</span></span>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">总SKU数(个)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #2E8B57;" id="TotalSKUNum">0</span>
                    <br style="line-height: 5px;" />
                    <span style="font-weight: lighter; font-size: 13px; color: #808080">库存SKU:<span style="font-size: 15px; font-weight: bold; color: #2E8B57;" id="InCargoSKUNum">0</span></span>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">总销量(条)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1cdb14;" id="TotalNum">0</span></td>
            </tr>
            <tr>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080;">日访问用户数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="DayUserCount">0</span>
                </td>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">月访问用户数</span>
                    <br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1ea7f7;" id="MonthUserCount">0</span>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">日访问门店数(家)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="DayClientCount">0</span>
                </td>
                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">月访问门店数(家)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ed2323;" id="MonthClientCount">0</span>
                    </div>
                </td>
                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">日浏览数(次)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #2E8B57;" id="DayClickCount">0</span>
                </td>

                <td>
                    <div class="boxDid">
                        <span style="font-weight: lighter; font-size: 15px; color: #808080">月退货量(条)</span><br />
                        <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="ReturnOrderMonthPiece">0</span>
                        <br style="line-height: 5px;" />
                        <span style="font-weight: lighter; font-size: 13px; color: #808080">日退货量:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="ReturnOrderDayPiece">0</span></span>

                    </div>
                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">月退货金额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #ff6a00;" id="ReturnOrderMonthCharge">0</span>
                    <br style="line-height: 5px;" />
                    <span style="font-weight: lighter; font-size: 13px; color: #808080">日退货金额:<span style="font-size: 15px; font-weight: bold; color: #ff6a00;" id="ReturnOrderDayCharge">0</span></span>
                </td>

                <td>
                    <span style="font-weight: lighter; font-size: 15px; color: #808080">月浏览数(次)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1cdb14;" id="MonthClickCount">0</span>

                </td>
                <td><span style="font-weight: lighter; font-size: 15px; color: #808080">总销售额(万)</span><br />
                    <br style="line-height: 5px;" />
                    <span style="font-size: 30px; font-weight: bold; color: #1cdb14;" id="TotalRevenue">0</span></td>
            </tr>
        </table>


    </div>
    <div style="width: 100%; height: 100%; border: 1px solid red;" id="ChartBox">
        <div style="width: 100%; display: flex;">
            <div style="width: 49%;">
                <canvas id="UserBar"></canvas>
            </div>
            <div style="width: 49%; margin-left: 1%;">
                <canvas id="StoresBar"></canvas>
            </div>

        </div>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 30%;">
                <canvas id="DayOrderNumBar"></canvas>
            </div>
            <div style="width: 40%;">
                <canvas id="DayOrderSalesVolumeBar"></canvas>
            </div>
            <div style="width: 30%;">
                <canvas id="DayOrderRevenueBar"></canvas>
            </div>
        </div>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 25%;" id="pn23" class="easyui-panel" title="品牌月销售排名">
                <table id="dgBrand" class="easyui-datagrid">
                </table>
            </div>
            <%--  <div style="width: 25%;">
                <table id="dgBrand" class="easyui-datagrid">
                </table>
            </div>--%>
            <div style="width: 50%;">
                <canvas id="canvBrandBar"></canvas>
            </div>
            <div style="width: 25%;">
                <canvas id="canvBrandPie" style="display: none;"></canvas>
            </div>
        </div>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 25%;" id="pn20" class="easyui-panel" title="品牌月浏览成交转化率">
                <table id="dgBrandConverRate" class="easyui-datagrid">
                </table>
            </div>
            <%-- <div style="width: 25%;">
                <table id="dgBrandConverRate" class="easyui-datagrid">
                </table>
            </div>--%>
            <div style="width: 50%; padding: 0px; margin: 0px;" id="pn21" class="easyui-panel" title="品牌浏览成交转化率">
                <canvas id="canvBrandConverRateBar"></canvas>
            </div>
            <%--  <div style="width: 50%;">
                <canvas id="canvBrandConverRateBar"></canvas>
            </div>--%>
            <div style="width: 25%;" id="pn22" class="easyui-panel" title="门店月浏览成交转化率">
                <table id="dgClientConverRate" class="easyui-datagrid">
                </table>
            </div>
            <%-- <div style="width: 25%;">
                <table id="dgClientConverRate" class="easyui-datagrid">
                </table>
            </div>--%>
        </div>

        <%--  <div style="width: 100%; display: flex; align-items: center;">
          
            <div style="width: 50%;">
                <canvas id="canvClientConverRateBar"></canvas>
            </div>
        </div>--%>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 25%;" id="pnl0" class="easyui-panel" title="品牌规格月销售排名" data-options="tools:'#tl0'">
                <table id="dgBrandTop30" class="easyui-datagrid">
                </table>
            </div>
            <div id="tl0">
                <a href="javascript:void(0)" class="icon-reload" onclick="QueryHCYC_BrandSpecsNum()" title="刷新"></a>
            </div>
            <div style="width: 42%;" id="pnl1" class="easyui-panel" title="本月客户浏览数据" data-options="tools:'#tl1'">
                <table id="dgDayAccessStatis" class="easyui-datagrid">
                </table>
            </div>

            <div id="tl1">
                <a href="javascript:void(0)" class="icon-add" onclick="HCYC_AddFeedBack()" title="添加回访"></a>
                <a href="javascript:void(0)" class="icon-application_get" onclick="HCYC_DayAccessNumExport()" title="导出"></a>
                <a href="javascript:void(0)" class="icon-reload" onclick="QueryHCYC_DayAccessNum()" title="刷新"></a>
            </div>
            <div style="width: 33%;" id="pnl2" class="easyui-panel" title="本月订单数据" data-options="tools:'#tl2'">
                <table id="dgSevenDayOrder" class="easyui-datagrid">
                </table>
            </div>
            <div id="tl2">
                <a href="javascript:void(0)" class="icon-application_get" onclick="HCYC_SevenDayOrderInfoExport()" title="导出"></a>
                <a href="javascript:void(0)" class="icon-reload" onclick="QueryHCYC_SevenDayOrderInfo()" title="刷新"></a>
            </div>
        </div>
        <div id="dlgFeedBack" class="easyui-dialog" style="width: 800px; height: 500px; padding: 0px"
            closed="true" buttons="#dlgFeedBack-buttons">
            <form id="fm" class="easyui-form" method="post">
                <input type="hidden" name="HouseID" id="FHouseID" />
                <input type="hidden" name="ID" id="FID" />
                <div id="saPanel">
                    <table>
                        <tr>
                            <td style="text-align: right;">门店名称:
                            </td>
                            <td>
                                <input name="CompanyName" id="FCompanyName" class="easyui-textbox" style="width: 250px; height: 30px;" readonly="readonly" />
                            </td>

                            <td style="text-align: right;">客户姓名:
                            </td>
                            <td>
                                <input name="Name" id="FName" class="easyui-textbox" style="width: 250px; height: 30px;" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: right;">回访人:
                            </td>
                            <td>
                                <input name="FeedBackName" id="FFeedBackName" class="easyui-textbox" style="width: 250px; height: 30px;" readonly="readonly" />
                            </td>

                            <td style="text-align: right;">回访时间:
                            </td>
                            <td>
                                <input name="FeedBackTime" id="FFeedBackTime" class="easyui-datetimebox" style="width: 250px; height: 30px;" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: right;">所属仓库:
                            </td>
                            <td>
                                <input name="HouseName" id="FHouseName" class="easyui-textbox" style="width: 250px; height: 30px;" readonly="readonly" />
                            </td>
                            <td style="text-align: right;">结果类型:
                            </td>
                            <td>
                                <select class="easyui-combobox" id="FResultType" name="ResultType" style="width: 250px; height: 30px;"
                                    panelheight="auto" required="true">
                                    <option value="1">成功下单</option>
                                    <option value="2">无库存</option>
                                    <option value="3">价格高</option>
                                    <option value="4">配送时效</option>
                                    <option value="5">周期年份问题</option>
                                    <option value="6">跟车主没达成交易</option>
                                    <option value="7">了解价格</option>
                                    <option value="8">选择其他品牌</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: right;">回访结果:
                            </td>
                            <td colspan="3">
                                <textarea id="FFeedBackResult" rows="15" name="FeedBackResult" style="width: 700px;"></textarea>
                            </td>
                        </tr>

                    </table>
                </div>
            </form>
        </div>
        <div id="dlgFeedBack-buttons">
            <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="saveFeedBack()">&nbsp;&nbsp;保&nbsp;存&nbsp;&nbsp;</a>&nbsp;&nbsp;&nbsp;&nbsp;
 <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#dlgFeedBack').dialog('close')">&nbsp;&nbsp;取&nbsp;消&nbsp;&nbsp;</a>
        </div>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 35%;" id="pn13" class="easyui-panel" title="品牌SKU统计" data-options="tools:'#tl3'">
                <table id="dgBrandSKUStatis" class="easyui-datagrid">
                </table>
            </div>
            <div id="tl3">
                <a href="javascript:void(0)" class="icon-reload" onclick="QueryHCYC_BrandSKUData()" title="刷新"></a>
            </div>
            <%--  <div style="width: 25%;">
                <table id="dgBrandSKUStatis" class="easyui-datagrid">
                </table>
            </div>--%>
            <div style="width: 60%; padding: 0px; margin: 0px;" id="pnl4" class="easyui-panel" title="品牌SKU统计表" data-options="tools:'#tl1'">
                <canvas id="canvBrandSKUStatisBar"></canvas>
            </div>
            <%--  <div style="width: 50%;">
                <canvas id="canvBrandSKUStatisBar"></canvas>
            </div>--%>
        </div>

        <div style="width: 100%; display: flex; align-items: center;">
            <div style="width: 40%;" id="pnl3" class="easyui-panel" title="客户关键字查询数据" data-options="tools:'#tl4'">
                <table id="dgKeyWordStatis" class="easyui-datagrid">
                </table>
            </div>
            <div id="tl4">
                <a href="javascript:void(0)" class="icon-application_get" onclick="HCYC_KeyWordNumExport()" title="导出"></a>
                <a href="javascript:void(0)" class="icon-reload" onclick="QueryHCYC_KeyWordNum()" title="刷新"></a>
            </div>

        </div>

    </div>



    <form runat="server" id="fm1">
        <asp:Button ID="btnDayAccessNumExport" runat="server" Style="display: none;" Text="导出" OnClick="btnDayAccessNumExport_Click" />
        <asp:Button ID="btnDerived" runat="server" Style="display: none;" Text="导出" OnClick="btnDerived_Click" />
        <asp:Button ID="btnKeyWordExport" runat="server" Style="display: none;" Text="导出" OnClick="btnKeyWordExport_Click" />
    </form>
    <script type="text/javascript">
        var CharTable = $(".CharTable")
        $(CharTable[0]).css("display", "")

        Chart.register(ChartDataLabels);

        var UserBar = document.getElementById('UserBar');
        var UserBarChart = new Chart(UserBar, {
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '增加数',
                    data: [12, 95, 45, 78, 96, 31],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        display: function (context) {
                            if (context.datasetIndex == 0) {
                                return true
                            }
                            else {
                                return false
                            }
                        },

                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },

                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '每日用户增长统计',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        var StoresBar = document.getElementById('StoresBar');
        var StoresBarChart = new Chart(StoresBar, {
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '销售量',
                    data: [12, 95, 45, 78, 96, 31],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        display: function (context) {
                            if (context.datasetIndex == 0) {
                                return true
                            }
                            else {
                                return false
                            }
                        },

                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '每日门店增长统计',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });


        var DayOrderNumBar = document.getElementById('DayOrderNumBar');
        var DayOrderNumBarChart = new Chart(DayOrderNumBar, {
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '销售量',
                    data: [12, 95, 45, 78, 96, 31],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '每日销售订单数',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        var DayOrderSalesVolumeBar = document.getElementById('DayOrderSalesVolumeBar');
        var DayOrderSalesVolumeBarChart = new Chart(DayOrderSalesVolumeBar, {
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '销售量',
                    data: [12, 95, 45, 78, 96, 31],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '每日订单销售量',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        var DayOrderRevenueBar = document.getElementById('DayOrderRevenueBar');
        var DayOrderRevenueBarChart = new Chart(DayOrderRevenueBar, {
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: '销售量',
                    data: [12, 95, 45, 78, 96, 31],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '每日销售额统计',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        //品牌销售统计柱状图
        var canvBrandBar = document.getElementById('canvBrandBar');
        var canvBrandBarChart = new Chart(canvBrandBar, {
            data: {
                labels: [],
                datasets: [{
                    label: '销售量',
                    data: [],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '品牌销售排名',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        //品牌销售统计饼图
        var canvBrandPie = document.getElementById('canvBrandPie');
        var canvBrandPieChart = new Chart(canvBrandPie, {
            type: 'pie',
            data: {
                labels: [],
                datasets: []
            },
            options: {
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    datalabels: {
                        display: true, // 确保设置为 true 来显示数据标签
                        formatter: function (value, context) {
                            return value + '%'; // 将值乘以100并转换为百分比形式
                        },
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    title: {
                        display: true,
                        text: '品牌销售占比',
                        align: 'center',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        //品牌销售转化率统计柱状图
        var canvBrandConverRateBar = document.getElementById('canvBrandConverRateBar');
        var canvBrandConverRateBarChart = new Chart(canvBrandConverRateBar, {
            data: {
                labels: [],
                datasets: [{
                    label: '销售量',
                    data: [],
                    type: 'bar',
                }]
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '品牌浏览成交转化率',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });


        //品牌SKU统计柱状图
        var canvBrandSKUStatisBar = document.getElementById('canvBrandSKUStatisBar');
        var canvBrandSKUStatisBarChart = new Chart(canvBrandSKUStatisBar, {
            data: {
                labels: [],
                datasets: []
            },
            options: {
                plugins: {
                    datalabels: {
                        color: 'Black',
                        font: {
                            weight: 'bold',
                            size: 15,
                        },
                        anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
                        //align: 'top', // 设置标签的对齐位置（相对于锚点）
                        //formatter: function (value) {
                        //    return value;
                        //}
                    },
                    //legend: {
                    //    position: 'top',
                    //},
                    title: {
                        display: true,
                        text: '品牌SKU统计',
                        font: {
                            size: 15
                        }
                    }

                },

            }
        });

        //门店销售转化率统计柱状图
        //var canvClientConverRateBar = document.getElementById('canvClientConverRateBar');
        //var canvClientConverRateBarChart = new Chart(canvClientConverRateBar, {
        //    data: {
        //        labels: [],
        //        datasets: [{
        //            label: '销售量',
        //            data: [],
        //            type: 'bar',
        //        }]
        //    },
        //    options: {
        //        plugins: {
        //            datalabels: {
        //                color: 'Black',
        //                font: {
        //                    weight: 'bold',
        //                    size: 15,
        //                },
        //                anchor: 'end', // 设置标签的锚点位置（位置相对于数据点）
        //                //align: 'top', // 设置标签的对齐位置（相对于锚点）
        //                //formatter: function (value) {
        //                //    return value;
        //                //}
        //            },
        //            //legend: {
        //            //    position: 'top',
        //            //},
        //            title: {
        //                display: true,
        //                text: '门店销售转化率',
        //                font: {
        //                    size: 15
        //                }
        //            }

        //        },

        //    }
        //});

        $(function () {
            var windowHeight = $(window).height() - 150;
            //$(".Chart").css("height", windowHeight)
            var datenow = new Date();
            $('#StartDate').datebox('setValue', getNowFormatDate(datenow.getFullYear().toString() + "-" + (datenow.getMonth() + 1).toString() + "-01"));
            $('#EndDate').datebox('setValue', getNowFormatDate(datenow));
            $('#HouseID').combobox({
                url: '../House/houseApi.aspx?method=CargoPermisionHouse', valueField: 'HouseID', textField: 'Name'
            });
            $('#HouseID').combobox('setValue', '<%=UserInfor.HouseID%>');
            RELOAD();
        });
        function RELOAD() {

            var alternatingColors = ['rgba(174,238,238,05)', 'rgba(118,238,198,0.5)'];
            var StoresalternatingColors = ['rgba(175,238,238,0.5)', 'rgba(64,224,208,0.5)'];

            var DayOrderalternatingColors = ['rgba(255,106,106,0.5)', 'rgba(238,99,99,0.5)'];
            //var DayOrderSalesVolumealternatingColors = ['rgba(224,255,255,0.5)', 'rgba(127,255,212,0.5)'];
            var DayOrderSalesVolumealternatingColors = ['#ff7f50', '#87cefa', '#da70d6', '#32cd32', '#6495ed', '#ff69b4', '#ba55d3', '#cd5c5c', '#ffa500', '#40e0d0', '#1e90ff', '#ff6347', '#7b68ee', '#00fa9a', '#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b', '#30e0e0'];

            var DayOrderRevenuealternatingColors = ['rgba(135,206,250,0.5)', 'rgba(127,255,212,0.5)'];

            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=HCYCStatistics",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (data) {
                    var newData = JSON.parse(data);
                    $("#UserCount").text(newData.Users.Count)
                    $("#UserDayCount").text(newData.Users.DayCount)
                    $("#UserMonthCount").text(newData.Users.MonthCount)

                    $("#StoresCount").text(newData.Stores.Count)
                    $("#StoresDayCount").text(newData.Stores.DayCount)
                    $("#StoresMonthCount").text(newData.Stores.MonthCount)

                    $("#DayOrderNum").text(newData?.Order==null?0:newData?.Order?.DayOrderNum)
                    $("#DayOrderRevenue").text(newData?.Order == null ? 0 : newData?.Order?.DayOrderRevenue)
                    $("#DayOrderSalesVolume").text(newData?.Order == null ? 0 : newData?.Order?.DayOrderSalesVolume)
                    $("#MonthOrderNum").text(newData?.Order == null ? 0 : newData?.Order?.MonthOrderNum)
                    $("#MonthOrderRevenue").text((newData?.Order == null ? 0 : newData?.Order?.MonthOrderRevenue / 10000).toFixed(2))
                    $("#MonthOrderSalesVolume").text(newData?.Order == null ? 0 : newData?.Order?.MonthOrderSalesVolume)
                    $("#TotalNum").text(newData?.Order == null ? 0 : newData?.Order?.TotalNum)
                    $("#TotalRevenue").text((newData?.Order == null ? 0 : newData?.Order?.TotalRevenue / 10000).toFixed(2))

                    $("#ReturnOrderDayPiece").text(newData?.Order == null ? 0 : newData?.Order?.ReturnOrderDayPiece)
                    $("#ReturnOrderMonthPiece").text(newData?.Order == null ? 0 : newData?.Order?.ReturnOrderMonthPiece)
                    $("#OESSaleOrderMonthPiece").text(newData?.Order == null ? 0 : newData?.Order?.OESSaleOrderMonthPiece)
                    $("#OESSaleOrderDayPiece").text(newData?.Order == null ? 0 : newData?.Order?.OESSaleOrderDayPiece)
                    $("#ReturnOrderMonthCharge").text((newData?.Order == null ? 0 : newData?.Order?.ReturnOrderMonthCharge / 10000).toFixed(2))
                    $("#ReturnOrderDayCharge").text((newData?.Order == null ? 0 : newData?.Order?.ReturnOrderDayCharge / 10000).toFixed(2))
                    $("#OESSaleOrderDayCharge").text((newData?.Order == null ? 0 : newData?.Order?.OESSaleOrderDayCharge / 10000).toFixed(2))
                    $("#OESSaleOrderMonthCharge").text((newData?.Order == null ? 0 : newData?.Order?.OESSaleOrderMonthCharge / 10000).toFixed(2))

                    // 循环遍历数据集，为每个柱状图设置交替的颜色



                    var Userlabels = [];
                    var Userdatas = {
                        data: [],
                        label: '增长数',
                        type: 'bar',
                        backgroundColor: [],
                        borderColor: [],
                    }
                    var UserdataLien = {
                        data: [],
                        label: '',
                        type: 'line',
                        fill: false,
                        borderColor: [],
                        backgroundColor: '#FF6A6A',
                    }
                    for (var i = 0; i < newData.Statistics.User.length; i++) {
                        Userlabels.push(newData.Statistics.User[i].Date)
                        Userdatas.data.push(newData.Statistics.User[i].Num)
                        UserdataLien.data.push(newData.Statistics.User[i].Num)
                    }
                    Userlabels.label = "增长数";
                    var len = UserBarChart.data.datasets.length
                    for (var i = 0; i < len; i++) {
                        UserBarChart.data.datasets.pop();
                    }
                    UserBarChart.data.datasets.pop();
                    UserBarChart.data.labels = Userlabels;
                    Userdatas.data.forEach((dataset, index) => {
                        var colorIndex = index % alternatingColors.length;
                        Userdatas.backgroundColor.push(alternatingColors[colorIndex]);
                        Userdatas.borderColor.push(alternatingColors[colorIndex]);
                        UserdataLien.borderColor.push('#FF6A6A');
                    });
                    UserBarChart.data.datasets.push(UserdataLien);
                    UserBarChart.data.datasets.push(Userdatas);

                    UserBarChart.update();
                    console.log(UserBarChart.data.datasets)
                    var Storeslabels = [];
                    var Storesdatas = {
                        data: [],
                        label: '增长数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var StoresdataLien = {
                        data: [],
                        label: '',
                        type: 'line',
                        fill: false,
                        borderColor: [],
                        backgroundColor: '#FF6A6A',
                    }
                    for (var i = 0; i < newData.Statistics.Stores.length; i++) {
                        Storeslabels.push(newData.Statistics.Stores[i].Date)
                        Storesdatas.data.push(newData.Statistics.Stores[i].Num)
                        StoresdataLien.data.push(newData.Statistics.Stores[i].Num)
                    }
                    len = StoresBarChart.data.datasets.length;
                    Storesdatas.label = "增长数";
                    for (var i = 0; i < len; i++) {
                        StoresBarChart.data.datasets.pop();
                    }
                    StoresBarChart.data.labels = Storeslabels;
                    Storesdatas.data.forEach((dataset, index) => {
                        var colorIndex = index % StoresalternatingColors.length;
                        Storesdatas.backgroundColor.push(StoresalternatingColors[colorIndex]);
                        Storesdatas.borderColor.push(StoresalternatingColors[colorIndex]);
                        StoresdataLien.borderColor.push('#FF6A6A');
                    });

                    StoresBarChart.data.datasets.push(Storesdatas);
                    StoresBarChart.data.datasets.push(StoresdataLien);
                    StoresBarChart.update();
                    console.log(StoresBarChart.data.datasets)


                    var DayOrderNumlabels = [];
                    var DayOrderNumdatas = {
                        data: [],
                        label: '订单数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],

                    }
                    var DayOrderSalesVolumedatas = {
                        data: [],
                        label: '轮胎条数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var DayOrderRevenuedatas = {
                        data: [],
                        label: '销售金额',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }


                    for (var i = 0; i < newData.Statistics.Order.length; i++) {
                        DayOrderNumlabels.push(newData.Statistics.Order[i].Date)
                        DayOrderNumdatas.data.push(newData.Statistics.Order[i].OrderNum)
                        DayOrderSalesVolumedatas.data.push(newData.Statistics.Order[i].OrderSalesVolume)
                        DayOrderRevenuedatas.data.push(newData.Statistics.Order[i].OrderRevenue)
                    }

                    DayOrderNumdatas.data.forEach((dataset, index) => {
                        var colorIndex = index % StoresalternatingColors.length;
                        DayOrderNumdatas.backgroundColor.push(DayOrderalternatingColors[colorIndex]);
                        DayOrderNumdatas.borderColor.push(DayOrderalternatingColors[colorIndex]);

                        DayOrderSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[colorIndex]);
                        DayOrderSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[colorIndex]);

                        DayOrderRevenuedatas.backgroundColor.push(DayOrderRevenuealternatingColors[colorIndex]);
                        DayOrderRevenuedatas.borderColor.push(DayOrderRevenuealternatingColors[colorIndex]);

                    });


                    DayOrderNumBarChart.data.datasets.pop();
                    DayOrderNumBarChart.data.labels = DayOrderNumlabels;
                    DayOrderNumBarChart.data.datasets.push(DayOrderNumdatas);
                    DayOrderNumBarChart.update();

                    DayOrderRevenueBarChart.data.datasets.pop();
                    DayOrderRevenueBarChart.data.labels = DayOrderNumlabels;
                    DayOrderRevenueBarChart.data.datasets.push(DayOrderRevenuedatas);
                    DayOrderRevenueBarChart.update();

                    DayOrderSalesVolumeBarChart.data.datasets.pop();
                    DayOrderSalesVolumeBarChart.data.labels = DayOrderNumlabels;
                    DayOrderSalesVolumeBarChart.data.datasets.push(DayOrderSalesVolumedatas);
                    DayOrderSalesVolumeBarChart.update();


                }
            });
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=HCYCAccessStatistics",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (data) {
                    var newData = JSON.parse(data);
                    $("#DayUserCount").text(newData.Users.DayUserCount);
                    $("#MonthUserCount").text(newData.Users.MonthUserCount);
                    $("#DayClientCount").text(newData.Users.DayClientCount);
                    $("#MonthClientCount").text(newData.Users.MonthClientCount);
                    $("#DayClickCount").text(newData.Users.DayClickCount);
                    $("#MonthClickCount").text(newData.Users.MonthClickCount);
                }
            });

            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_BrandNum",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var result = JSON.parse(dt);
                    var data = result.rows;
                    $('#dgBrand').datagrid('loadData', result);
                    var brandLabels = [];
                    var brandSalesVolumedatas = {
                        data: [],
                        label: '销量',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var newBrandSalePie = {
                        data: [],
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var sum = 0;
                    for (var j = 0; j < data.length; j++) {
                        sum += data[j].OrderPiece
                    }
                    for (var i = 0; i < data.length; i++) {


                        brandLabels.push(data[i].TypeName);
                        brandSalesVolumedatas.data.push(data[i].OrderPiece);
                        brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);

                        newBrandSalePie.data.push(((parseFloat(data[i].OrderPiece) / sum) * 100).toFixed(2))
                        newBrandSalePie.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        newBrandSalePie.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                    }

                    canvBrandBarChart.data.datasets.pop();
                    canvBrandBarChart.data.labels = brandLabels;
                    canvBrandBarChart.data.datasets.push(brandSalesVolumedatas);
                    canvBrandBarChart.update();


                    canvBrandPieChart.data.datasets.pop();
                    canvBrandPieChart.data.labels = brandLabels;
                    canvBrandPieChart.data.datasets.push(newBrandSalePie);
                    canvBrandPieChart.options.plugins.title.display = true;
                    $("#canvBrandPie").css("display", "")
                    canvBrandPieChart.update();
                }
            });

            QueryHCYC_BrandSpecsNum();

            setTimeout(function () {
                QueryHCYC_DayAccessNum();
                //近七日销售订单
                QueryHCYC_SevenDayOrderInfo();
                QueryHCYC_KeyWordNum();
            }, 300)

            //品牌月销售转化率
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_BrandConverRate",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var result = JSON.parse(dt);
                    var data = result.rows;
                    $('#dgBrandConverRate').datagrid('loadData', result);

                    var brandLabels = [];
                    var brandSalesVolumedatas = {
                        data: [],
                        label: '转化率',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    for (var i = 0; i < data.length; i++) {
                        brandLabels.push(data[i].TypeName);
                        brandSalesVolumedatas.data.push(data[i].OrderNumRate);
                        brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                    }

                    canvBrandConverRateBarChart.data.datasets.pop();
                    canvBrandConverRateBarChart.data.labels = brandLabels;
                    canvBrandConverRateBarChart.data.datasets.push(brandSalesVolumedatas);
                    canvBrandConverRateBarChart.update();
                }
            });
            //门店月销售转化率
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_ClientConverRate",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var data = JSON.parse(dt);
                    $('#dgClientConverRate').datagrid('loadData', data);

                    //var brandLabels = [];
                    //var brandSalesVolumedatas = {
                    //    data: [],
                    //    label: '转化率',
                    //    type: 'bar',
                    //    borderColor: [],
                    //    backgroundColor: [],
                    //}
                    //for (var i = 0; i < data.length; i++) {
                    //    brandLabels.push(data[i].ClientName);
                    //    brandSalesVolumedatas.data.push(data[i].OrderNum);
                    //    brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                    //    brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                    //}

                    //canvClientConverRateBarChart.data.datasets.pop();
                    //canvClientConverRateBarChart.data.labels = brandLabels;
                    //canvClientConverRateBarChart.data.datasets.push(brandSalesVolumedatas);
                    //canvClientConverRateBarChart.update();
                }
            });

            //SKU数据统计
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_BrandSKUData",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var result = JSON.parse(dt);
                    var data = result.rows;
                    $('#dgBrandSKUStatis').datagrid('loadData', result);

                    var brandLabels = [];
                    var brandSalesVolumedatas = {
                        data: [],
                        label: '总SKU数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var brandSalesVolumedatasIN = {
                        data: [],
                        label: '在库SKU数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var brandSalesVolumedatasSaled = {
                        data: [],
                        label: '已售SKU数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var TotalSKUNum = 0;
                    var InCargoSKUNum = 0;
                    for (var i = 0; i < data.length; i++) {
                        TotalSKUNum += data[i].SKUTotalNum;
                        InCargoSKUNum += data[i].InCargoSKUNum;
                        brandLabels.push(data[i].TypeName);
                        brandSalesVolumedatas.data.push(data[i].SKUTotalNum);
                        brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);

                        brandSalesVolumedatasIN.data.push(data[i].InCargoSKUNum);
                        brandSalesVolumedatasIN.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatasIN.borderColor.push(DayOrderSalesVolumealternatingColors[i]);

                        brandSalesVolumedatasSaled.data.push(data[i].SaledSKUNum);
                        brandSalesVolumedatasSaled.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatasSaled.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                    }
                    $("#TotalSKUNum").text(TotalSKUNum);
                    $("#InCargoSKUNum").text(InCargoSKUNum);

                    canvBrandSKUStatisBarChart.data.datasets.pop();
                    canvBrandSKUStatisBarChart.data.datasets.pop();
                    canvBrandSKUStatisBarChart.data.datasets.pop();
                    canvBrandSKUStatisBarChart.data.labels = brandLabels;
                    canvBrandSKUStatisBarChart.data.datasets.push(brandSalesVolumedatas);
                    canvBrandSKUStatisBarChart.data.datasets.push(brandSalesVolumedatasIN);
                    canvBrandSKUStatisBarChart.data.datasets.push(brandSalesVolumedatasSaled);
                    canvBrandSKUStatisBarChart.update();
                }
            });
        }

        function QueryHCYC_BrandSKUData() {
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_BrandSKUData",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var data = eval(dt);
                    $('#dgBrandSKUStatis').datagrid('loadData', data);

                    var brandLabels = [];
                    var brandSalesVolumedatas = {
                        data: [],
                        label: '总SKU数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var brandSalesVolumedatasIN = {
                        data: [],
                        label: '在库SKU数',
                        type: 'bar',
                        borderColor: [],
                        backgroundColor: [],
                    }
                    var TotalSKUNum = 0;
                    var InCargoSKUNum = 0;
                    for (var i = 0; i < data.length; i++) {
                        TotalSKUNum += data[i].SKUTotalNum;
                        InCargoSKUNum += data[i].InCargoSKUNum;
                        brandLabels.push(data[i].TypeName);
                        brandSalesVolumedatas.data.push(data[i].SKUTotalNum);
                        brandSalesVolumedatas.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatas.borderColor.push(DayOrderSalesVolumealternatingColors[i]);

                        brandSalesVolumedatasIN.data.push(data[i].InCargoSKUNum);
                        brandSalesVolumedatasIN.backgroundColor.push(DayOrderSalesVolumealternatingColors[i]);
                        brandSalesVolumedatasIN.borderColor.push(DayOrderSalesVolumealternatingColors[i]);
                    }
                    $("#TotalSKUNum").text(TotalSKUNum);
                    $("#InCargoSKUNum").text(InCargoSKUNum);

                    canvBrandSKUStatisBarChart.data.datasets.pop();
                    canvBrandSKUStatisBarChart.data.datasets.pop();
                    canvBrandSKUStatisBarChart.data.labels = brandLabels;
                    canvBrandSKUStatisBarChart.data.datasets.push(brandSalesVolumedatas);
                    canvBrandSKUStatisBarChart.data.datasets.push(brandSalesVolumedatasIN);
                    canvBrandSKUStatisBarChart.update();
                }
            });
        }


        function QueryHCYC_BrandSpecsNum() {
            $.ajax({
                type: 'post',
                url: "reportApi_v2.aspx?method=QueryHCYC_BrandSpecsNum",
                data: {
                    HouseID: $('#HouseID').combobox('getValue'),
                    StartDate: $('#StartDate').datebox('getValue'),
                    EndDate: $('#EndDate').datebox('getValue'),
                },
                success: function (dt) {
                    var data = JSON.parse(dt);
                    $('#dgBrandTop30').datagrid('loadData', data);
                }
            });
        }

        function QueryHCYC_SevenDayOrderInfo() {
            //$.ajax({
            //    type: 'post',
            //    url: "reportApi_v2.aspx?method=QueryHCYC_SevenDayOrderInfo",
            //    data: {
            //        HouseID: $('#HouseID').combobox('getValue'),
            //        StartDate: $('#StartDate').datebox('getValue'),
            //        EndDate: $('#EndDate').datebox('getValue'),
            //    },
            //    success: function (dt) {
            //        var data = eval(dt);
            //        $('#dgSevenDayOrder').datagrid('loadData', data);

            //    }
            //});

            var gridOpts = $('#dgSevenDayOrder').datagrid('options');
            gridOpts.url = "reportApi_v2.aspx?method=QueryHCYC_SevenDayOrderInfo";
            $('#dgSevenDayOrder').datagrid('load', {
                HouseID: $('#HouseID').combobox('getValue'),
                StartDate: $('#StartDate').datebox('getValue'),
                EndDate: $('#EndDate').datebox('getValue'),
            });
        }

        function QueryHCYC_DayAccessNum() {
            //$.ajax({
            //    type: 'post',
            //    url: "reportApi_v2.aspx?method=QueryHCYC_DayAccessNum",
            //    data: {
            //        HouseID: $('#HouseID').combobox('getValue'),
            //        StartDate: $('#StartDate').datebox('getValue'),
            //        EndDate: $('#EndDate').datebox('getValue'),
            //    },
            //    success: function (dt) {
            //        var data = eval(dt);
            //        $('#dgDayAccessStatis').datagrid('loadData', data);
            //    }
            //});

            var gridOpts = $('#dgDayAccessStatis').datagrid('options');
            gridOpts.url = "reportApi_v2.aspx?method=QueryHCYC_DayAccessNum";
            $('#dgDayAccessStatis').datagrid('load', {
                HouseID: $('#HouseID').combobox('getValue'),
                StartDate: $('#StartDate').datebox('getValue'),
                EndDate: $('#EndDate').datebox('getValue'),
            });
        }
        //保存客户回访数据
        function saveFeedBack() {
            $('#fm').form('submit', {
                url: 'reportApi.aspx?method=saveFeedBack',
                onSubmit: function () {
                    return $(this).form('enableValidation').form('validate');
                },
                success: function (msg) {
                    var result = eval('(' + msg + ')');
                    if (result.Result) {
                        $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '保存成功!', 'info');
                        $('#dlgFeedBack').dialog('close'); 	// close the dialog
                        QueryHCYC_DayAccessNum();
                    } else {
                        $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '保存失败：' + result.Message, 'warning');
                    }
                }
            })
        }

        //添加客户回访
        function HCYC_AddFeedBack() {
            var row = $('#dgDayAccessStatis').datagrid('getSelected');
            if (row == null || row == "") {
                $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '请选择要操作的数据！', 'warning');
                return;
            }
            if (row) {
                $('#dlgFeedBack').dialog('open').dialog('setTitle', '新增客户回访信息');
                $('#fm').form('clear');
                $('#FHouseID').val(row.HouseID);
                $('#FID').val(row.id);

                var hna = $('#HouseID').textbox('getText');

                $('#FHouseName').textbox('setValue', hna);
                $('#FName').textbox('setValue', row.Name);
                $('#FCompanyName').textbox('setValue', row.CompanyName);
                $('#FFeedBackName').textbox('setValue', '<%= UserInfor.UserName%>');
                var d = new Date();
                $('#FFeedBackTime').datetimebox('setValue', AllDateTime(d));

                $('#FResultType').combobox('textbox').bind('focus', function () { $('#FResultType').combobox('showPanel'); });

            }
        }
        //近7日浏览数据导出
        function HCYC_DayAccessNumExport() {
            var row = $("#dgDayAccessStatis").datagrid('getData').rows[0];
            if (row == null) { $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '没有数据可以进行导出，请重新查询！', 'warning'); return; }
            var obj = document.getElementById("<%=btnDayAccessNumExport.ClientID %>"); obj.click();
        }
        //本月订单导出
        function HCYC_SevenDayOrderInfoExport() {
            var row = $("#dgSevenDayOrder").datagrid('getData').rows[0];
            if (row == null) { $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '没有数据可以进行导出，请重新查询！', 'warning'); return; }
            var obj = document.getElementById("<%=btnDerived.ClientID %>"); obj.click();
        }
        //关键字搜索查询
        function QueryHCYC_KeyWordNum() {
            //$.ajax({
            //    type: 'post',
            //    url: "reportApi_v2.aspx?method=QueryHCYC_KeyWordNum",
            //    data: {
            //        HouseID: $('#HouseID').combobox('getValue'),
            //        StartDate: $('#StartDate').datebox('getValue'),
            //        EndDate: $('#EndDate').datebox('getValue'),
            //    },
            //    success: function (dt) {
            //        var data = eval(dt);
            //        $('#dgKeyWordStatis').datagrid('loadData', data);
            //    }
            //});
            var gridOpts = $('#dgKeyWordStatis').datagrid('options');
            gridOpts.url = "reportApi_v2.aspx?method=QueryHCYC_KeyWordNum";
            $('#dgKeyWordStatis').datagrid('load', {
                HouseID: $('#HouseID').combobox('getValue'),
                StartDate: $('#StartDate').datebox('getValue'),
                EndDate: $('#EndDate').datebox('getValue'),
            });
        }
        //关键字搜索导出
        function HCYC_KeyWordNumExport() {
            var row = $("#dgKeyWordStatis").datagrid('getData').rows[0];
            if (row == null) { $.messager.alert('<%= Cargo.Common.GetSystemNameAndVersion()%>', '没有数据可以进行导出，请重新查询！', 'warning'); return; }
            var obj = document.getElementById("<%=btnKeyWordExport.ClientID %>"); obj.click();
        }

    </script>
</asp:Content>
