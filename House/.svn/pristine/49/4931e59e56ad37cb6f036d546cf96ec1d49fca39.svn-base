<%@ Page Title="标点地图" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="PunctuationMap.aspx.cs" Inherits="Cargo.Report.PunctuationMap" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
  <style type="text/css">
    .box {
      position: absolute;
      left: 10px;
      top: 10px;
      height: 20px;
      z-index: 10000;
      background-color: #fff;
      padding: 10px 10px;
    }
    .btnBox {
      font-size: 15px;
      margin-bottom: 10px;
    }
    .btnBox label {
      margin: 0px 5px;
      cursor: pointer;
    }
  </style>
    <script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
    <script type="text/javascript">
</script>
</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">
    <div class="box">
        <div class="btnBox">
            <label for="hz">
                <input type="radio" id="hz" value="0" name="type" />
                华中
            </label>
            <label for="hn">
                <input type="radio" id="hn" value="1" name="type" />
                华南
            </label>
            <label for="hb">
                <input type="radio" id="hb" value="2" name="type" />
                华北
            </label>
            <label for="hd">
                <input type="radio" id="hd" value="3" name="type" />
                华东
            </label>
            <label for="db">
                <input type="radio" id="db" value="4" name="type" />
                东北
            </label>
            <label for="xb">
                <input type="radio" id="xb" value="5" name="type" />
                西北
            </label>
            <label for="xn">
                <input type="radio" id="xn" value="6" name="type" />
                西南
            </label>
        </div>
    </div>
    <div>
        <div id="map"></div>
    </div>
    <script type="text/javascript">
        var viewMode = '2D';
        function changeViewMode() {
            if (viewMode == '2D') {
                map.setViewMode('3D');
                map.setPitch(70);
                viewMode = '3D';
            } else {
                map.setViewMode('2D');
                viewMode = '2D';
            }
        }
        function restore() {
            infoWindow.close();
            markerCluster.setMap(null);
            markerCluster = null;
            //map.easeTo({ zoom: 5.2, rotation: 0, center: MapCenter }, { duration: 2000 });//平滑缩放,旋转到指定级别
            map.setBaseMap({
                type: 'vector',
                features: ['base', 'building2d'],
            });
            var bounds = new TMap.LatLngBounds();

            //判断标注点是否在范围内
            MarkerGeometries.forEach(function (item) {
                //若坐标点不在范围内，扩大bounds范围
                if (bounds.isEmpty() || !bounds.contains(item.position)) {
                    bounds.extend(item.position);
                }
            })
            //设置地图可视范围
            map.fitBounds(bounds, {
                padding: 100 // 自适应边距
            });
        }
        $('#map').append('<input type="button" id="restore" onclick="restore()" value="复位" style="right: 31px;height: 33px;width: 39px;top: 88px;z-index: 10000;background-color: #ffffff;border: none;border-radius: 3px;outline: none;position:absolute" />');
        //$('#map').append('<input type="button" id="changeViewMode" onclick="changeViewMode()" value="切换" style="right: 31px;height: 33px;width: 39px;top: 122px;z-index: 10000;background-color: #ffffff;border: none;border-radius: 3px;outline: none;position:absolute" />');
        MapCenter = new TMap.LatLng(35, 106);//设置中心点坐标
        // 初始化地图
        var map = new TMap.Map('map', {
            zoom: 5.2, // 设置地图缩放级别
            //pitch: 30,
            center: MapCenter, // 设置地图中心点坐标
            // mapStyleId: "style1", //个性化样式
            baseMap: {
                type: 'vector',
                features: ['base', 'building2d'], // 隐藏矢量文字
            },
        });
        map.removeControl(TMap.constants.DEFAULT_CONTROL_ID.ZOOM);
        $(function () {
            MarkerGeometries = [
                {
                    styleId: 'small', // 对应中的样式id
                    position: new TMap.LatLng(34.611451, 108.284457), // 标注点位置
                    content: '西安好来运网点', // 标注点文本
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(34.211451, 108.584457),
                    content: '西安好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(28.700385, 112.191656),
                    content: '长沙好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(28.120385, 112.701656),
                    content: '长沙好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(39.278867, 116.571452),
                    content: '北京好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(39.778867, 116.771452),
                    content: '北京好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(23.157013, 113.718508),
                    content: '广州好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    styleId: 'small',
                    position: new TMap.LatLng(23.857013, 113.118508),
                    content: '广州好来运网点',
                    properties: {
                        title: 'branch',
                        type: 'branch'
                    },
                },
                {
                    id: '西安好来运',
                    styleId: 'big',
                    position: new TMap.LatLng(34.211451, 108.984457),
                    content: '西安好来运',
                    properties: {
                        title: 'marker',
                        type: 'main'
                    },
                },
                {
                    id: '长沙好来运',
                    styleId: 'big',
                    position: new TMap.LatLng(28.200385, 112.791656),
                    content: '长沙好来运',
                    properties: {
                        title: 'marker',
                        type: 'main'
                    },
                },
                {
                    id: '北京好来运',
                    styleId: 'big',
                    position: new TMap.LatLng(39.978867, 116.371452),
                    content: '北京好来运',
                    properties: {
                        title: 'marker',
                        type: 'main'
                    },
                },
                {
                    id: '广州好来运',
                    styleId: 'big',
                    position: new TMap.LatLng(23.257013, 113.318508),
                    content: '广州好来运',
                    properties: {
                        title: 'marker',
                        type: 'main'
                    },
                },
            ]
            // marker
            marker = new TMap.MultiMarker({
                map: map, // 显示Marker图层的底图
                styles: {
                    small: new TMap.MarkerStyle({
                        // 点标注的相关样式
                        width: 17, // 宽度
                        height: 23, // 高度
                        anchor: { x: 17, y: 23 }, // 标注点图片的锚点位置
                        src: 'https://mapapi.qq.com/web/lbs/visualizationApi/demo/img/small.png', // 标注点图片url或base64地址
                        color: '#333', // 标注点文本颜色
                        size: 16, // 标注点文本文字大小
                        direction: 'bottom', // 标注点文本文字相对于标注点图片的方位
                        offset: { x: 0, y: 8 }, // 标注点文本文字基于direction方位的偏移属性
                        strokeColor: '#fff', // 标注点文本描边颜色
                        strokeWidth: 2, // 标注点文本描边宽度
                    }),
                    big: new TMap.MarkerStyle({
                        width: 29,
                        height: 38,
                        anchor: { x: 36, y: 32 },
                        src: 'https://mapapi.qq.com/web/lbs/visualizationApi/demo/img/big.png',
                        color: '#333',
                        size: 22,
                        direction: 'bottom',
                        strokeColor: '#fff',
                        offset: { x: 0, y: 10 },
                        strokeWidth: 2,
                    }),
                },
                enableCollision: true, // 开启碰撞
                geometries: MarkerGeometries,
            });
            marker.on("click", eventClick)
            //初始化
            var bounds = new TMap.LatLngBounds();

            //判断标注点是否在范围内
            MarkerGeometries.forEach(function (item) {
                //若坐标点不在范围内，扩大bounds范围
                if (bounds.isEmpty() || !bounds.contains(item.position)) {
                    bounds.extend(item.position);
                }
            })
            //设置地图可视范围
            map.fitBounds(bounds, {
                padding: 100 // 自适应边距
            });
        });
        //监听回调函数（非匿名函数）
        var eventClick = function (evt) {
            //alert(evt.geometry.id);
            //markerID.innerHTML = "markerID:" + evt.geometry.id;
            //position.innerHTML = "当前marker位置：" + evt.geometry.position.toString();
            if (evt.geometry.properties.type == "main") {
                map.setBaseMap({
                    type: 'vector',
                    features: ['base', 'building2d', 'point'/*, 'label'*/],
                });
                map.easeTo({ zoom: 9, rotation: 0, center: evt.geometry.position }, { duration: 2000 });//平滑缩放,旋转到指定级别

                // 创建点聚合实例
                markerCluster = new TMap.MarkerCluster({
                    id: 'cluster',
                    map: map,
                    enableDefaultStyle: true, // 启用默认样式
                    minimumClusterSize: 2, // 形成聚合簇的最小个数
                    geometries: [{ // 点数组
                        position: new TMap.LatLng(23.157013, 113.518508)
                    },
                    {
                        position: new TMap.LatLng(23.357013, 113.418508)
                    },
                    {
                        position: new TMap.LatLng(23.457013, 113.318508)
                    },
                    {
                        position: new TMap.LatLng(23.557013, 113.218508)
                    },
                    {
                        position: new TMap.LatLng(23.657013, 113.118508)
                    },
                    {
                        position: new TMap.LatLng(23.757013, 113.018508)
                    },
                    {
                        position: new TMap.LatLng(23.857013, 113.098508)
                    },
                    {
                        position: new TMap.LatLng(23.957013, 113.088508)
                    },
                    ],
                    zoomOnClick: true, // 点击簇时放大至簇内点分离
                    gridSize: 60, // 聚合算法的可聚合距离
                    averageCenter: false, // 每个聚和簇的中心是否应该是聚类中所有标记的平均值
                    maxZoom: 10 // 采用聚合策略的最大缩放级别
                });
            } else {
                infoWindow.close();//初始关闭信息窗关闭
                //初始化infoWindow
                infoWindow = new TMap.InfoWindow({
                    map: map,
                    position: new TMap.LatLng(39.984104, 116.307503),
                    offset: { x: -10, y: -32 } //设置信息窗相对position偏移像素
                });
                infoWindow.open(); //打开信息窗
                infoWindow.setPosition(evt.geometry.position);//设置信息窗位置
                infoWindow.setContent(evt.geometry.properties.title.toString());//设置信息窗内容
            }
        }
        //初始化infoWindow
        infoWindow = new TMap.InfoWindow({
            map: map,
            position: new TMap.LatLng(39.984104, 116.307503),
            offset: { x: -10, y: -32 } //设置信息窗相对position偏移像素
        });
        infoWindow.close();//初始关闭信息窗关闭

        ////拼接标记内容
        //var markerArr = [{
        //    "id": "marker1",
        //    "styleId": 'marker',
        //    "position": new TMap.LatLng(39.954104, 116.457503),
        //    //'content': "123", //标注文本
        //    "properties": {
        //        "title": "marker1"
        //    }
        //}, {
        //    "id": "marker2",
        //    "styleId": 'marker',
        //    "position": new TMap.LatLng(39.794104, 116.287503),
        //    //'content': "123", //标注文本
        //    "properties": {
        //        "title": "marker2"
        //    }
        //}, {
        //    "id": "marker3",
        //    "styleId": 'marker',
        //    "position": new TMap.LatLng(39.984104, 116.307503),
        //    //'content': "123", //标注文本
        //    "properties": {
        //        "title": "marker3"
        //    }
        //}

        //];
        ////初始化标记
        //var marker = new TMap.MultiMarker({
        //    id: 'marker-layer',
        //    map: map,
        //    styles: {
        //        "marker": new TMap.MarkerStyle({
        //            "width": 25,
        //            "height": 35,
        //            "anchor": { x: 16, y: 32 },
        //            "src": 'https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerDefault.png'
        //        })
        //    },
        //    geometries: markerArr
        //});
        //// 拼接label显示内容
        //var labelGeometries = [{
        //    'id': 'label', //点图形数据的标志信息
        //    'styleId': 'label', //样式id
        //    'position': new TMap.LatLng(39.954104, 116.457503), //标注点位置
        //    'content': "123", //标注文本
        //    'properties': { //标注点的属性数据
        //        'title': 'label'
        //    }
        //}]
        //// 初始化label
        //var label = new TMap.MultiLabel({
        //    id: 'label-layer',
        //    map: map,
        //    styles: {
        //        label: new TMap.LabelStyle({
        //            color: '#3777FF', // 颜色属性
        //            size: 20, // 文字大小属性
        //            offset: { x: -5, y: -40 }, // 文字偏移属性单位为像素
        //            angle: 0, // 文字旋转属性
        //            alignment: 'center', // 文字水平对齐属性
        //            verticalAlignment: 'middle', // 文字垂直对齐属性
        //        }),
        //    },
        //    geometries: labelGeometries,
        //});

        ////初始化
        //var bounds = new TMap.LatLngBounds();

        ////判断标注点是否在范围内
        //markerArr.forEach(function (item) {
        //    //若坐标点不在范围内，扩大bounds范围
        //    if (bounds.isEmpty() || !bounds.contains(item.position)) {
        //        bounds.extend(item.position);
        //    }
        //})
        ////设置地图可视范围
        //map.fitBounds(bounds, {
        //    padding: 100 // 自适应边距
        //});


        ////初始化地图
        //var map = new TMap.Map("map", {
        //    zoom: 5,//设置地图缩放级别
        //    center: center//设置地图中心点坐标
        //});
        //var center = new TMap.LatLng(23.257013, 113.318508);
        //// MultiMarker文档地址：https://lbs.qq.com/webApi/javascriptGL/glDoc/glDocMarker
        //var marker = new TMap.MultiMarker({
        //    map: map,
        //    styles: {
        //        // 点标记样式
        //        marker: new TMap.MarkerStyle({
        //            width: 20, // 样式宽
        //            height: 30, // 样式高
        //            anchor: { x: 10, y: 30 }, // 描点位置
        //            src: https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerDefault.png
        //        }),
        //    },
        //    geometries: [
        //        // 点标记数据数组
        //        {
        //            // 标记位置(纬度，经度，高度)
        //            position: center,
        //            id: 'marker',
        //        },
        //    ],
        //});
        //// 初始化label
        //var label = new TMap.MultiLabel({
        //    id: 'label-layer',
        //    map: map,
        //    styles: {
        //        label: new TMap.LabelStyle({
        //            color: '#3777FF', // 颜色属性
        //            size: 20, // 文字大小属性
        //            offset: { x: 0, y: -10 }, // 文字偏移属性单位为像素
        //            angle: 0, // 文字旋转属性
        //            alignment: 'center', // 文字水平对齐属性
        //            verticalAlignment: 'middle', // 文字垂直对齐属性
        //        }),
        //    },
        //    geometries: [
        //        {
        //            id: 'label', // 点图形数据的标志信息
        //            styleId: 'label', // 样式id
        //            position: center, // 标注点位置
        //            content: '狄乐汽服', // 标注文本
        //            properties: {
        //                // 标注点的属性数据
        //                title: 'label',
        //            },
        //        },
        //    ],
        //});
    </script>
</asp:Content>
